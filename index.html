<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- C·∫¨P NH·∫¨T: Ti√™u ƒë·ªÅ m·ªõi -->
    <title>English With Me - Website H·ªçc Ti·∫øng Anh (v7 - N·ªôi dung m·ªü r·ªông)</title>
    
    <!-- Nh√∫ng font Inter & Pacifico t·ª´ Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&family=Pacifico&display=swap" rel="stylesheet">
    
    <!-- Nh√∫ng Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- C·∫•u h√¨nh Tailwind -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'sans': ['Inter', 'sans-serif'],
                        'logo': ['Pacifico', 'cursive'],
                    },
                    colors: {
                        'primary': {
                            'DEFAULT': '#0ea5e9', // sky-500
                            'hover': '#0284c7', // sky-600
                        },
                        'secondary': {
                            'DEFAULT': '#8b5cf6', // violet-500
                            'hover': '#7c3aed', // violet-600
                        },
                        'light-bg': '#f0f9ff', // sky-50
                        'ai-bg': '#faf5ff', // purple-50
                    }
                }
            }
        }
    </script>

    <style>
        /* C√†i ƒë·∫∑t chung & Reset */
        :root {
            --primary-color: #0ea5e9; /* Tailwind sky-500 */
            --primary-hover: #0284c7; /* Tailwind sky-600 */
            --light-blue-bg: #f0f9ff; /* Tailwind sky-50 */
            --dark-text: #1f2937;     /* Tailwind gray-800 */
            --medium-text: #4b5563;  /* Tailwind gray-600 */
            --dark-red: #dc2626;      /* Tailwind red-600 */
            --success-green: #16a34a;  /* Tailwind green-600 */
            --success-green-hover: #15803d; /* Tailwind green-700 */
            
            --ai-purple: #8b5cf6;     /* Tailwind violet-500 */
            --ai-purple-hover: #7c3aed; /* Tailwind violet-600 */
            --ai-bg: #faf5ff;       /* Tailwind purple-50 */
            
            --bg-soft: #f8fafc;       /* Tailwind slate-50 */
        }

        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-soft);
            color: var(--dark-text);
            line-height: 1.6;
        }

        /* 1. C√°c th√†nh ph·∫ßn chung */

        /* Top Bar */
        .top-bar {
            background-color: #1e293b; /* Tailwind slate-800 */
            color: white;
            padding: 8px 10%;
            text-align: right;
            font-size: 0.9em;
        }

        .top-bar a {
            color: white;
            text-decoration: none;
            margin-left: 15px;
            transition: opacity 0.3s;
            cursor: pointer;
        }

        .top-bar a:hover {
            opacity: 0.8;
        }

        /* Header */
        .header {
            background-color: white;
            text-align: center;
            padding: 25px 20px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
        }

        .header .logo {
            font-family: 'Pacifico', cursive;
            font-size: 3em;
            color: #1f2937; /* Tailwind gray-800 */
            margin: 0;
            text-decoration: none;
        }

        /* Navbar */
        .navbar {
            background-color: #334155; /* Tailwind slate-700 */
            padding: 10px 0;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .navbar a {
            color: white;
            text-decoration: none;
            padding: 12px 20px;
            display: inline-block;
            font-weight: 700;
            transition: background-color 0.3s;
            cursor: pointer;
            border-radius: 6px; 
            margin: 0 4px;
        }

        .navbar a:hover,
        .navbar a.active-nav {
            background-color: #475569; /* Tailwind slate-600 */
        }

        /* Footer */
        .footer {
            background-color: #e2e8f0; /* Tailwind slate-200 */
            color: #475569; /* Tailwind slate-600 */
            text-align: center;
            padding: 25px;
            margin-top: 40px;
            border-top: 1px solid #cbd5e1; /* Tailwind slate-300 */
            font-size: 0.9em;
        }

        /* 2. C·∫•u tr√∫c trang (Page) */

        /* Container */
        .subpage-container {
            max-width: 1200px;
            margin: 30px auto;
            padding: 2rem 1.5rem; /* 32px 24px */
            background-color: white;
            border-radius: 1.5rem; /* 24px */
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        @media (min-width: 768px) {
            .subpage-container {
                padding: 3rem; /* 48px */
            }
        }

        .subpage-container h1 {
            text-align: center;
            font-size: 2.25rem; /* 36px */
            font-weight: 800;
            color: #000;
            margin-bottom: 30px;
        }

        /* Page visibility */
        .page {
            display: none;
        }
        .page.active {
            display: block;
        }

        /* N√∫t chung */
        .btn {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 24px; 
            border-radius: 0.75rem; /* 12px */
            cursor: pointer;
            font-weight: 700;
            text-decoration: none;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease-in-out;
        }

        .btn:hover {
            background-color: var(--primary-hover);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            background-color: #94a3b8; /* Tailwind slate-400 */
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .btn-back {
            background-color: #64748b; /* Tailwind slate-500 */
            margin-bottom: 20px;
        }
        .btn-back:hover {
            background-color: #475569; /* Tailwind slate-600 */
        }

        /* 3. Trang ch·ªß (Home Page) */

        /* Hero Section */
        .hero {
            background-color: var(--light-blue-bg);
            padding: 60px 20px;
            text-align: center;
        }

        .hero-content {
            position: relative;
            max-width: 800px;
            margin: 0 auto;
        }

        .hero-content h2 {
            font-size: 2.5em; /* 40px */
            color: #1e3a8a; /* Tailwind blue-900 */
            font-weight: 800; /* Extra-bold */
            margin: 0;
            line-height: 1.3;
        }
        @media (min-width: 768px) {
            .hero-content h2 {
                font-size: 3em; /* 48px */
            }
        }

        /* Welcome Section */
        .welcome {
            padding: 60px 20px;
            text-align: center;
            background-color: white;
        }

        .welcome h2 {
            font-size: 2em;
            font-weight: 700; 
            color: #000;
            margin-bottom: 15px;
        }

        .welcome p {
            max-width: 700px;
            margin: 0 auto;
            font-size: 1.1em;
            color: var(--medium-text);
        }

        /* Features Section */
        .features {
            background-color: var(--light-blue-bg);
            padding: 60px 20px;
        }

        .feature-grid {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
        }

        /* Th·∫ª t√≠nh nƒÉng */
        .feature-card {
            background-color: white;
            border-radius: 1rem; /* 16px */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            width: 300px;
            padding: 25px;
            text-align: center;
            text-decoration: none;
            color: var(--dark-text);
            transition: all 0.3s ease-in-out;
            cursor: pointer;
        }

        .feature-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        .feature-card h3 {
            font-size: 1.5em;
            font-weight: 700;
            color: #000;
            margin-top: 0;
            margin-bottom: 15px;
        }
        
        .feature-card-icon {
            width: 64px;
            height: 64px;
            margin: 0 auto 20px auto;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: var(--light-blue-bg);
            border-radius: 50%;
        }
        .feature-card-icon svg {
            width: 32px;
            height: 32px;
            color: var(--primary-color);
        }
        
        /* T√≠nh nƒÉng T·ª´ v·ª±ng m·ªói ng√†y (AI) */
        .word-of-the-day {
            background-color: var(--ai-bg);
            padding: 60px 20px;
            text-align: center;
        }
        .word-of-the-day h2 {
            font-size: 2em;
            font-weight: 700; 
            color: var(--ai-purple);
            margin-top: 0;
            margin-bottom: 30px;
        }
        .word-container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            border-radius: 1rem; /* 16px */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            padding: 30px;
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            align-items: center;
        }
        
        /* Spinner CSS */
        .loader {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--ai-purple);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .word-content {
            text-align: left;
        }
        .word-image-container {
            width: 100%;
            height: 250px;
            background-color: #f3f4f6; /* Tailwind gray-100 */
            border-radius: 0.75rem; /* 12px */
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        .word-image-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        #word-term {
            font-size: 2.2em;
            font-weight: 700;
            color: var(--ai-purple);
            margin: 0;
        }
        #word-definition {
            font-size: 1.1em;
            color: var(--medium-text);
            margin: 10px 0;
        }
        #word-example {
            font-size: 1.1em;
            color: var(--dark-text);
            font-style: italic;
            border-left: 4px solid var(--ai-purple);
            padding-left: 10px;
            margin: 15px 0 0 0;
            background-color: #f9fafb; /* Tailwind gray-50 */
            padding-top: 8px;
            padding-bottom: 8px;
        }
        
        .btn-ai {
            background-color: var(--ai-purple);
            margin-top: 25px;
        }
        .btn-ai:hover {
            background-color: var(--ai-purple-hover);
        }
        
        #word-error {
            color: var(--dark-red);
            display: none;
        }

        /* Layout AI cho m√†n h√¨nh l·ªõn */
        @media (min-width: 768px) {
            .word-container {
                grid-template-columns: 300px 1fr;
                gap: 30px;
            }
            .word-image-container {
                height: 100%;
                min-height: 250px;
            }
        }


        /* 4. Trang Video H∆∞·ªõng D·∫´n */
        .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }

        .video-item {
            border: 1px solid #e5e7eb; /* Tailwind gray-200 */
            border-radius: 1rem; /* 16px */
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease-in-out;
            cursor: pointer;
            background-color: white;
        }

        .video-item:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transform: translateY(-4px);
        }

        .video-item img {
            width: 100%;
            height: 170px;
            object-fit: cover;
            display: block;
            background-color: #f3f4f6; /* N·ªÅn m·ªù khi t·∫£i */
        }

        .video-item-content {
            padding: 20px;
        }

        .video-item-content h3 {
            margin-top: 0;
            font-size: 1.2em;
            font-weight: 700;
        }
        .video-item-content p {
            font-size: 0.95em;
            color: var(--medium-text);
        }

        /* 5. Trang ƒê·ªÅ √în Thi */
        .test-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .test-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            padding: 20px;
            border: 1px solid #e5e7eb; /* Tailwind gray-200 */
            border-radius: 0.75rem; /* 12px */
            background-color: #f9fafb; /* Tailwind gray-50 */
            transition: all 0.2s ease-in-out;
        }
        .test-item:hover {
            background-color: white;
            border-color: #d1d5db; /* Tailwind gray-300 */
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }

        .test-info h3 {
            margin: 0 0 5px 0;
            font-weight: 700;
        }

        .test-info p {
            margin: 0;
            font-size: 0.9em;
            color: var(--medium-text);
        }

        /* L∆∞·ªõi n·ªôi dung chung (Cambridge/Global Success) */
        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
        }
        .content-item {
            background-color: white;
            border: 1px solid #e5e7eb;
            border-radius: 1rem; /* 16px */
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease-in-out;
            text-align: center;
            padding-bottom: 20px; 
        }
        .content-item:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transform: translateY(-4px);
        }
        .content-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            margin-bottom: 15px;
            background-color: #f3f4f6;
        }
        .content-item-text {
            padding: 0 20px; 
        }
        .content-item h3 {
            margin-top: 0;
            font-size: 1.2em;
            font-weight: 700;
        }
        .content-item .btn {
            margin-top: 15px;
        }
        
        /* Icon ho√†n th√†nh */
        .completion-icon {
            color: var(--success-green);
            font-weight: bold;
            margin-left: 8px;
            font-size: 1.2em;
        }

        /* Trang b√†i h·ªçc */
        .lesson-section {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e5e7eb;
        }
        .lesson-section:last-of-type {
            border-bottom: none;
            padding-bottom: 0;
            margin-bottom: 0;
        }
        .lesson-section h2 {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 5px;
            display: inline-block;
            font-weight: 700; 
        }
        .lesson-section ul {
            list-style-type: disc;
            margin-left: 20px;
            line-height: 1.8;
            color: var(--medium-text);
        }
        .lesson-section p {
            color: var(--medium-text);
        }
        
        /* M·ªöI: CSS CHO DANH S√ÅCH T·ª™ V·ª∞NG C√ì H√åNH ·∫¢NH */
        .vocab-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            list-style-type: none;
            padding: 0;
            margin-top: 20px;
        }
        .vocab-item {
            border: 1px solid #e5e7eb;
            border-radius: 0.75rem;
            padding: 15px;
            text-align: center;
            background-color: #f9fafb;
            transition: all 0.2s ease-in-out;
        }
        .vocab-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
        }
        .vocab-item img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 0.5rem;
            margin-bottom: 10px;
            background-color: var(--light-blue-bg);
        }
        .vocab-item strong {
            font-size: 1.2em;
            color: var(--primary-color);
            display: block;
        }
        .vocab-item p {
            margin: 5px 0 0 0;
            font-size: 1em;
            color: var(--medium-text);
        }
        /* K·∫æT TH√öC CSS M·ªöI */
        
        /* N√∫t ho√†n th√†nh */
        .btn-complete {
            background-color: var(--success-green);
            margin-top: 20px;
            width: 100%;
            padding: 15px;
            font-size: 1.1em;
        }
        .btn-complete:hover {
            background-color: var(--success-green-hover);
        }
        .btn-complete.completed,
        .btn-complete:disabled {
            background-color: #64748b; /* Tailwind slate-500 */
            cursor: not-allowed;
            opacity: 0.8;
        }

        /* 6. Trang Game √în T·∫≠p */
        .game-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
        }

        .game-card {
            background-color: white;
            border: 1px solid #e5e7eb;
            border-radius: 1rem; /* 16px */
            text-align: center;
            padding-bottom: 20px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease-in-out;
            overflow: hidden;
        }

        .game-card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transform: translateY(-4px);
        }

        .game-card img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            margin-bottom: 15px;
        }
        
        .game-card-text {
             padding: 0 20px; 
        }

        .game-card h3 {
            margin: 0 0 15px 0;
            font-weight: 700;
        }

        /* 7. Responsive */
        @media (max-width: 768px) {
            .top-bar {
                padding: 8px 5%;
                text-align: center;
            }
            .navbar {
                padding: 5px 0;
            }
            .navbar a {
                padding: 10px 8px;
                font-size: 0.9em;
            }
            .hero-content h2 {
                font-size: 1.8em;
            }
            .welcome h2 {
                font-size: 1.7em;
            }
            .test-item {
                flex-direction: column;
                align-items: flex-start;
            }
            .modal-content {
                width: 95% !important;
            }
            .flashcard-grid-container {
                grid-template-columns: repeat(2, 1fr);
            }
            .wc-game-area {
                flex-direction: column;
            }
            .wc-grid-container {
                width: 100%;
                max-width: 350px;
                margin-top: 20px;
            }
            #wc-found-words {
                width: 100%;
                max-width: none;
                height: 150px;
            }
            /* M·ªöI: Responsive cho vocab list */
            .vocab-list {
                grid-template-columns: 1fr;
            }
        }
        
        /* 8. CSS T√çNH NƒÇNG M·ªöI (C≈©) */
        
        /* Form ƒêƒÉng nh·∫≠p / ƒêƒÉng k√Ω */
        .auth-form-container {
            max-width: 450px;
            margin: 40px auto;
            padding: 30px;
            border-radius: 1rem; /* 16px */
            background-color: var(--bg-soft);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 700;
        }
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #d1d5db; /* Tailwind gray-300 */
            border-radius: 0.5rem; /* 8px */
            box-sizing: border-box;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .form-group input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(14, 165, 233, 0.3); /* Ring color */
        }
        
        .auth-form-container .btn {
            width: 100%;
            padding: 15px;
            font-size: 1.1em;
        }
        .auth-switch {
            text-align: center;
            margin-top: 20px;
        }
        .auth-switch a {
            color: var(--primary-color);
            font-weight: 700;
            text-decoration: none;
            cursor: pointer;
        }
        .auth-switch a:hover {
            text-decoration: underline;
        }
        .auth-message {
            margin-bottom: 15px;
            padding: 12px;
            border-radius: 5px;
            display: none; 
            text-align: center;
        }
        .auth-message.success {
            background-color: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }
        .auth-message.error {
            background-color: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }

        /* Video Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 1rem; /* 16px */
            width: 70%;
            max-width: 800px;
            position: relative;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        .modal-close {
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 2.5em;
            font-weight: bold;
            color: #9ca3af;
            cursor: pointer;
        }
        .modal-close:hover {
            color: #1f2937;
        }
        .video-player-container {
            width: 100%;
            margin-top: 15px;
            position: relative;
            padding-bottom: 56.25%; 
            height: 0;
            overflow: hidden;
            background: #000;
            border-radius: 0.75rem; /* 12px */
        }
        .video-player-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        /* Trang Quiz */
        .quiz-question-text {
            font-size: 1.5em;
            font-weight: 700;
            margin-bottom: 20px;
        }
        .quiz-options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        .quiz-option {
            background: #f9fafb;
            border: 2px solid #d1d5db;
            padding: 15px;
            border-radius: 0.75rem; /* 12px */
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }
        .quiz-option:hover {
            border-color: var(--primary-color);
            background-color: var(--light-blue-bg);
        }
        .quiz-option.selected {
            background: var(--light-blue-bg);
            border-color: var(--primary-color);
            font-weight: bold;
            box-shadow: 0 0 0 2px rgba(14, 165, 233, 0.3);
        }
        .quiz-option.correct {
            background: #d1fae5;
            border-color: #a7f3d0;
        }
        .quiz-option.wrong {
            background: #fee2e2;
            border-color: #fecaca;
        }
        #quiz-next-btn {
            margin-top: 20px;
        }
        #quiz-result {
            text-align: center;
            font-size: 1.2em;
        }
        
        /* Khu v·ª±c b√¨nh lu·∫≠n */
        .comment-section {
            margin-top: 40px;
            border-top: 2px solid #e5e7eb;
            padding-top: 20px;
        }
        .comment-list {
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 20px;
            border: 1px solid #e5e7eb;
            border-radius: 0.75rem; /* 12px */
            padding: 10px;
            background-color: var(--bg-soft);
        }
        .comment-item {
            padding: 12px;
            border-bottom: 1px solid #f3f4f6;
        }
        .comment-item:last-child {
            border-bottom: none;
        }
        .comment-item strong {
            display: block;
            font-size: 0.95em;
            color: var(--primary-color);
            font-weight: 700;
        }
        .comment-item small {
            font-size: 0.8em;
            color: #6b7280;
            display: block;
            margin-top: 2px;
        }
        .comment-item p {
            margin: 5px 0 0 0;
            color: #374151;
        }
        .comment-form textarea {
            width: 100%;
            min-height: 80px;
            padding: 10px;
            border-radius: 0.5rem; /* 8px */
            border: 1px solid #d1d5db;
            box-sizing: border-box;
            margin-bottom: 10px;
            font-family: 'Inter', sans-serif;
            font-size: 1em;
        }
        .comment-form textarea:focus {
             outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(14, 165, 233, 0.3);
        }
        .comment-form .auth-message {
            margin-top: -5px; 
        }

        /* Trang Game Flashcard */
        .flashcard-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            font-size: 1.1em;
        }
        .flashcard-grid-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            perspective: 1000px;
        }
        .flashcard {
            width: 100%;
            height: 150px;
            background-color: transparent;
            cursor: pointer;
        }
        .flashcard-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border-radius: 0.75rem; /* 12px */
        }
        .flashcard.flipped .flashcard-inner {
            transform: rotateY(180deg);
        }
        .flashcard-front, .flashcard-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 0.75rem; /* 12px */
            font-size: 1.2em;
            font-weight: 700;
        }
        .flashcard-front {
            background-color: var(--primary-color);
            color: white;
        }
        .flashcard-back {
            background-color: var(--light-blue-bg);
            color: var(--dark-text);
            transform: rotateY(180deg);
            padding: 10px;
            box-sizing: border-box;
        }
        .flashcard.matched .flashcard-inner {
            transform: rotateY(180deg);
            opacity: 0.5;
        }
        .flashcard.matched {
            cursor: default;
        }
        
        /* CSS CHO GAME N·ªêI T·ª™ (WORD CONNECT) */
        .wc-game-area {
            display: flex;
            justify-content: space-around;
            align-items: flex-start;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        #wc-found-words {
            width: 250px;
            max-width: 100%;
            height: 350px;
            background: #f9fafb;
            border: 1px solid #d1d5db;
            border-radius: 0.75rem; /* 12px */
            padding: 15px;
            overflow-y: auto;
        }
        #wc-found-words h3 {
            margin-top: 0;
            text-align: center;
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 10px;
            font-weight: 700;
        }
        #wc-found-list {
            list-style-type: none;
            padding-left: 0;
            text-align: center;
        }
        #wc-found-list li {
            font-size: 1.2em;
            color: var(--success-green);
            font-weight: bold;
            padding: 4px 0;
        }
        .wc-grid-container {
            width: 350px;
            max-width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        #wc-grid {
            display: grid;
            grid-template-columns: repeat(3, 80px); /* 3x3 grid */
            gap: 15px;
            margin-top: 20px;
            touch-action: none;
        }
        .wc-letter {
            width: 80px;
            height: 80px;
            background: var(--light-blue-bg);
            border: 2px solid var(--primary-color);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2em;
            font-weight: 700;
            color: var(--primary-color);
            cursor: pointer;
            user-select: none;
            transition: background-color 0.2s;
        }
        .wc-letter.selected {
            background: var(--primary-color);
            color: white;
        }
        #wc-current-word {
            height: 50px;
            width: 100%;
            background: #f3f4f6;
            border-radius: 0.5rem; /* 8px */
            margin-top: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.8em;
            font-weight: bold;
            color: var(--dark-text);
            letter-spacing: 2px;
        }
        .wc-controls {
            margin-top: 20px;
            display: flex;
            gap: 15px;
        }
        #wc-level-info {
            text-align: center;
            font-size: 1.2em;
            font-weight: bold;
        }

        /* CSS CHO GAME ƒêI·ªÄN V√ÄO CH·ªñ TR·ªêNG (FILL BLANK) */
        .fb-game-container {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }
        #fb-progress {
            font-size: 1.1em;
            color: var(--medium-text);
            margin-bottom: 20px;
        }
        #fb-sentence-container {
            font-size: 1.5em;
            font-weight: 500;
            line-height: 1.8;
            margin-bottom: 25px;
        }
        #fb-input {
            width: 150px;
            font-size: 1.4em;
            text-align: center;
            border: none;
            border-bottom: 3px solid var(--primary-color);
            padding: 5px;
            margin: 0 5px;
            border-radius: 4px 4px 0 0;
            background-color: var(--light-blue-bg);
        }
        #fb-input:focus {
            outline: none;
            background-color: #e0f2fe; /* Tailwind sky-100 */
        }
        #fb-check-btn {
            padding: 15px 30px;
            font-size: 1.1em;
            margin-top: 10px;
        }
        #fb-feedback {
            margin-top: 20px;
            font-size: 1.3em;
            font-weight: bold;
        }
        #fb-feedback.correct {
            color: var(--success-green);
        }
        #fb-feedback.wrong {
            color: var(--dark-red);
        }
        #fb-results {
            margin-top: 30px;
        }
        #fb-results h2 {
            font-size: 1.8em;
            font-weight: 700;
        }
        #fb-results-score {
            font-size: 1.4em;
            margin-bottom: 20px;
        }
        
        /* CSS B·∫£ng X·∫øp H·∫°ng */
        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 1.1em;
        }
        .leaderboard-table th,
        .leaderboard-table td {
            border: 1px solid #d1d5db;
            padding: 12px 15px;
            text-align: left;
        }
        .leaderboard-table th {
            background-color: var(--light-blue-bg);
            color: var(--primary-color);
            font-weight: 700;
        }
        .leaderboard-table tr:nth-child(even) {
            background-color: #f9fafb;
        }
        .leaderboard-table td:first-child {
            font-weight: bold;
            text-align: center;
        }
        /* Icon cho top 3 */
        .leaderboard-table tr:nth-child(1) td:first-child::before {
            content: 'ü•á ';
        }
        .leaderboard-table tr:nth-child(2) td:first-child::before {
            content: 'ü•à ';
        }
        .leaderboard-table tr:nth-child(3) td:first-child::before {
            content: 'ü•â ';
        }
        
    </style>
</head>
<body class="bg-slate-50">

    <!-- PH·∫¶N 1: C√ÅC TH√ÄNH PH·∫¶N CHUNG -->

    <!-- Top Bar -->
    <div class="top-bar">
        <a id="login-link" href="#" onclick="showPage('login')">ƒêƒÉng nh·∫≠p</a>
        <a id="register-link" href="#" onclick="showPage('register')">ƒêƒÉng k√Ω</a>
        <a id="profile-link" href="#" onclick="showPage('profile')" style="display: none;">H·ªì s∆°</a>
        <a id="logout-link" href="#" onclick="handleLogout(event)" style="display: none;">ƒêƒÉng xu·∫•t</a>
    </div>

    <!-- Header (Logo) -->
    <header class="header">
        <a href="#" onclick="showPage('home')" class="logo">English With Me</a>
    </header>

    <!-- Navbar (Menu ch√≠nh) -->
    <nav class="navbar">
        <a href="#" data-page="home" onclick="showPage('home')">Home</a>
        <a href="#" data-page="cambridge" onclick="showPage('cambridge')">Cambridge</a>
        <a href="#" data-page="globalsuccess" onclick="showPage('globalsuccess')">Global Success</a>
        <a href="#" data-page="tests" onclick="showPage('tests')">T√†i li·ªáu √¥n thi</a>
        <a href="#" data-page="games" onclick="showPage('games')">Game</a>
        <a href="#" data-page="leaderboard" onclick="showPage('leaderboard')">B·∫£ng x·∫øp h·∫°ng</a>
    </nav>

    <!-- PH·∫¶N 2: N·ªòI DUNG C√ÅC TRANG (Page) -->
    <main>

        <!-- Trang 1: Home (M·∫∑c ƒë·ªãnh hi·ªÉn th·ªã) -->
        <div id="page-home" class="page active">
            
            <!-- Hero Section -->
            <section class="hero">
                <div class="hero-content">
                    <h2 class="text-3xl sm:text-4xl md:text-5xl font-extrabold text-sky-800">
                        ENGLISH LEARNING WEBSITE FOR GRADE 5<br>
                        CAMBRIDGE PROGRAM -<br>
                        GLOBAL SUCCESS PROGRAM
                    </h2>
                </div>
            </section>

            <!-- Welcome Section -->
            <section class="welcome">
                <h2>Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi English With Me!</h2>
                <p>
                    English With Me l√† n·ªÅn t·∫£ng t·ªïng h·ª£p t·ª´ v·ª±ng v√† ng·ªØ ph√°p t·ª´ ch∆∞∆°ng tr√¨nh
                    Cambridge v√† Global Success d√†nh cho h·ªçc sinh l·ªõp 5, ƒëi k√®m c√°c video b√†i
                    gi·∫£ng sinh ƒë·ªông v√† b√†i luy·ªán t·∫≠p th·ª±c h√†nh, gi√∫p b·∫°n ghi nh·ªõ l√¢u h∆°n v√† h·ªçc
                    hi·ªáu qu·∫£ h∆°n m·ªói ng√†y.
                </p>
            </section>
            
            <!-- T√çNH NƒÇNG T·ª™ V·ª∞NG M·ªñI NG√ÄY (AI) -->
            <section class="word-of-the-day">
                <h2>T·ª´ v·ª±ng m·ªói ng√†y</h2>
                <div class="word-container">
                    
                    <!-- Tr·∫°ng th√°i Loading -->
                    <div id="word-loading">
                        <div class="flex justify-center items-center h-full">
                            <div class="loader animate-spin rounded-full h-12 w-12 border-t-4 border-b-4 border-purple-500"></div>
                        </div>
                        <p class="mt-4">AI ƒëang t√¨m t·ª´ v·ª±ng m·ªõi...</p>
                    </div>
                    
                    <!-- N·ªôi dung sau khi t·∫£i -->
                    <div id="word-display" style="display: none;">
                        <div class="word-image-container bg-slate-200">
                            <img id="word-image" src="" alt="H√¨nh ·∫£nh minh h·ªça cho t·ª´ v·ª±ng" class="transition-opacity duration-500 opacity-0" onerror="this.src='https://placehold.co/300x250/fef2f2/dc2626?text=L·ªói+T·∫£i+·∫¢nh'">
                        </div>
                        <div class="word-content">
                            <h3 id="word-term"></h3>
                            <p id="word-definition"></p>
                            <p id="word-example"></p>
                        </div>
                    </div>

                    <!-- Th√¥ng b√°o l·ªói -->
                    <p id="word-error" style="display: none;">Kh√¥ng th·ªÉ t·∫£i t·ª´ v·ª±ng. Vui l√≤ng th·ª≠ l·∫°i.</p>
                </div>
                <button id="new-word-btn" class="btn btn-ai">Nh·∫≠n t·ª´ m·ªõi</button>
            </section>
            <!-- K·∫æT TH√öC T√çNH NƒÇNG AI -->

            <!-- Features Section (C·∫¨P NH·∫¨T: Th√™m Icons) -->
            <section class="features">
                <div class="feature-grid">
                    
                    <!-- Th·∫ª 1: Link ƒë·∫øn trang Video -->
                    <a href="#" onclick="showPage('videos')" class="feature-card">
                        <div class="feature-card-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.348a1.125 1.125 0 0 1 0 1.971l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z" />
                            </svg>
                        </div>
                        <h3>Video h∆∞·ªõng d·∫´n</h3>
                        <p>Gi·∫£i th√≠ch tr·ª±c quan t·ª´ng ch·ªß ƒë·ªÅ, minh h·ªça b·∫±ng v√≠ d·ª• th·ª±c t·∫ø.</p>
                    </a>
                    
                    <!-- Th·∫ª 2: Link ƒë·∫øn trang ƒê·ªÅ thi -->
                    <a href="#" onclick="showPage('tests')" class="feature-card">
                        <div class="feature-card-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" />
                            </svg>
                        </div>
                        <h3>T·ªïng h·ª£p ƒë·ªÅ √¥n thi</h3>
                        <p>H·ªá th·ªëng ƒë·ªÅ thi ƒë∆∞·ª£c ch·ªçn l·ªçc, gi√∫p b·∫°n luy·ªán t·∫≠p v√† ki·ªÉm tra nƒÉng l·ª±c th·∫≠t s√°t th·ª±c t·∫ø.</p>
                    </a>
                    
                    <!-- Th·∫ª 3: Link ƒë·∫øn trang Game -->
                    <a href="#" onclick="showPage('games')" class="feature-card">
                        <div class="feature-card-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M6 6.878V6a2.25 2.25 0 0 1 2.25-2.25h7.5A2.25 2.25 0 0 1 18 6v.878m-12 0c.235-.083.487-.128.75-.128h10.5c.263 0 .515.045.75.128m-12 0A2.25 2.25 0 0 0 4.5 9v.878m13.5-3A2.25 2.25 0 0 1 19.5 9v.878m0 0a2.246 2.246 0 0 0-.75-.128H5.25c-.263 0-.515.045-.75.128m15 0A2.25 2.25 0 0 1 21 12v6a2.25 2.25 0 0 1-2.25 2.25H5.25A2.25 2.25 0 0 1 3 18v-6c0-.98.626-1.813 1.5-2.122" />
                            </svg>
                        </div>
                        <h3>Game √¥n t·∫≠p th√∫ v·ªã</h3>
                        <p>V·ª´a ch∆°i v·ª´a h·ªçc v·ªõi c√°c mini game gi√∫p ghi nh·ªõ t·ª´ v·ª±ng t·ª± nhi√™n v√† l√¢u d√†i.</p>
                    </a>
                </div>
            </section>

        </div> <!-- K·∫øt th√∫c #page-home -->

        <!-- Trang 2: Video H∆∞·ªõng D·∫´n (C·∫¨P NH·∫¨T: TH√äM VIDEO) -->
        <div id="page-videos" class="page">
            <div class="subpage-container">
                <h1>Video H∆∞·ªõng D·∫´n</h1>
                <div class="video-grid">
                    <!-- Video item 1 -->
                    <div class="video-item" onclick="openVideoModal('B√†i 1: Th√¨ Hi·ªán t·∫°i ƒë∆°n (Present Simple)', '2rohVIy3v1U')">
                        <img src="https://img.youtube.com/vi/2rohVIy3v1U/hqdefault.jpg" alt="Thumbnail video 1" onerror="this.src='https://placehold.co/300x170/fef2f2/dc2626?text=L·ªói+·∫¢nh'">
                        <div class="video-item-content">
                            <h3>B√†i 1: Th√¨ Hi·ªán t·∫°i ƒë∆°n (Present Simple)</h3>
                            <p>M√¥ t·∫£ ng·∫Øn v·ªÅ n·ªôi dung video, c√°ch s·ª≠ d·ª•ng v√† c√°c v√≠ d·ª• c∆° b·∫£n.</p>
                        </div>
                    </div>
                    <!-- Video item 2 -->
                    <div class="video-item" onclick="openVideoModal('B√†i 2: T·ª´ v·ª±ng ch·ªß ƒë·ªÅ ƒê·ªông v·∫≠t (Animals)', 'aC8v4Cb19hc')">
                        <img src="https://img.youtube.com/vi/aC8v4Cb19hc/hqdefault.jpg" alt="Thumbnail video 2" onerror="this.src='https://placehold.co/300x170/fef2f2/dc2626?text=L·ªói+·∫¢nh'">
                        <div class="video-item-content">
                            <h3>B√†i 2: T·ª´ v·ª±ng ch·ªß ƒë·ªÅ ƒê·ªông v·∫≠t (Animals)</h3>
                            <p>H·ªçc t·ª´ v·ª±ng v·ªÅ c√°c lo√†i ƒë·ªông v·∫≠t hoang d√£ v√† v·∫≠t nu√¥i.</p>
                        </div>
                    </div>
                    <!-- Video item 3 -->
                    <div class="video-item" onclick="openVideoModal('B√†i 3: C·∫•u tr√∫c There is / There are', '4QGP1jsUims')">
                        <img src="https://img.youtube.com/vi/4QGP1jsUims/hqdefault.jpg" alt="Thumbnail video 3" onerror="this.src='https://placehold.co/300x170/fef2f2/dc2626?text=L·ªói+·∫¢nh'">
                        <div class="video-item-content">
                            <h3>B√†i 3: C·∫•u tr√∫c "There is / There are"</h3>
                            <p>C√°ch s·ª≠ d·ª•ng c·∫•u tr√∫c ch·ªâ s·ª± t·ªìn t·∫°i c·ªßa s·ª± v·∫≠t, s·ª± vi·ªác.</p>
                        </div>
                    </div>
                    <!-- Video item 4 -->
                    <div class="video-item" onclick="openVideoModal('B√†i 4: Gi·ªõi t·ª´ ch·ªâ n∆°i ch·ªën (Prepositions)', '-J0MjpK93UE')">
                        <img src="https://img.youtube.com/vi/-J0MjpK93UE/hqdefault.jpg" alt="Thumbnail video 4" onerror="this.src='https://placehold.co/300x170/fef2f2/dc2626?text=L·ªói+·∫¢nh'">
                        <div class="video-item-content">
                            <h3>B√†i 4: Gi·ªõi t·ª´ ch·ªâ n∆°i ch·ªën (Prepositions)</h3>
                            <p>H·ªçc c√°c gi·ªõi t·ª´ ph·ªï bi·∫øn: in, on, at, under, behind...</p>
                        </div>
                    </div>
                    <!-- M·ªöI: Video item 5 -->
                    <div class="video-item" onclick="openVideoModal('Truy·ªán Ti·∫øng Anh: The Ant and the Grasshopper', '9Rk8qGq201c')">
                        <img src="https://img.youtube.com/vi/9Rk8qGq201c/hqdefault.jpg" alt="Thumbnail video 5" onerror="this.src='https://placehold.co/300x170/fef2f2/dc2626?text=L·ªói+·∫¢nh'">
                        <div class="video-item-content">
                            <h3>Truy·ªán Ti·∫øng Anh: The Ant and the Grasshopper</h3>
                            <p>Luy·ªán nghe qua c√¢u chuy·ªán ng·ª• ng√¥n "Ki·∫øn v√† Ch√¢u ch·∫•u".</p>
                        </div>
                    </div>
                    <!-- M·ªöI: Video item 6 -->
                    <div class="video-item" onclick="openVideoModal('B√†i h√°t: Th√¨ Qu√° kh·ª© ƒë∆°n (Past Simple)', 'J3_fG-QdCgY')">
                        <img src="https://img.youtube.com/vi/J3_fG-QdCgY/hqdefault.jpg" alt="Thumbnail video 6" onerror="this.src='https://placehold.co/300x170/fef2f2/dc2626?text=L·ªói+·∫¢nh'">
                        <div class="video-item-content">
                            <h3>B√†i h√°t: Th√¨ Qu√° kh·ª© ƒë∆°n (Past Simple)</h3>
                            <p>H·ªçc ng·ªØ ph√°p th√¨ Qu√° kh·ª© ƒë∆°n qua m·ªôt b√†i h√°t vui nh·ªôn.</p>
                        </div>
                    </div>
                    <!-- M·ªöI: Video item 7 -->
                    <div class="video-item" onclick="openVideoModal('B√†i h√°t: Th·ªùi ti·∫øt (The Weather Song)', 'e5UT2-n1Yto')">
                        <img src="https://img.youtube.com/vi/e5UT2-n1Yto/hqdefault.jpg" alt="Thumbnail video 7" onerror="this.src='https://placehold.co/300x170/fef2f2/dc2626?text=L·ªói+·∫¢nh'">
                        <div class="video-item-content">
                            <h3>B√†i h√°t: Th·ªùi ti·∫øt (The Weather Song)</h3>
                            <p>H·ªçc t·ª´ v·ª±ng v·ªÅ ch·ªß ƒë·ªÅ th·ªùi ti·∫øt qua b√†i h√°t.</p>
                        </div>
                    </div>
                    <!-- M·ªöI: Video item 8 -->
                    <div class="video-item" onclick="openVideoModal('Ng·ªØ ph√°p: How much / How many', '9vH-Hj1gY2I')">
                        <img src="https://img.youtube.com/vi/9vH-Hj1gY2I/hqdefault.jpg" alt="Thumbnail video 8" onerror="this.src='https://placehold.co/300x170/fef2f2/dc2626?text=L·ªói+·∫¢nh'">
                        <div class="video-item-content">
                            <h3>Ng·ªØ ph√°p: How much / How many</h3>
                            <p>Ph√¢n bi·ªát c√°ch d√πng "How much" v√† "How many" cho danh t·ª´ ƒë·∫øm ƒë∆∞·ª£c v√† kh√¥ng ƒë·∫øm ƒë∆∞·ª£c.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div> <!-- K·∫øt th√∫c #page-videos -->

        <!-- Trang 3: T·ªïng H·ª£p ƒê·ªÅ √în Thi (C·∫¨P NH·∫¨T: TH√äM ƒê·ªÄ) -->
        <div id="page-tests" class="page">
            <div class="subpage-container">
                <h1>T·ªïng H·ª£p ƒê·ªÅ √în Thi</h1>
                <div class="test-list">
                    <!-- Test item 1 -->
                    <div class="test-item">
                        <div class="test-info">
                            <h3>ƒê·ªÅ ki·ªÉm tra 15 ph√∫t - Unit 1: My New School</h3>
                            <p>Th·ªùi gian: 15 ph√∫t | S·ªë c√¢u h·ªèi: 10</p>
                        </div>
                        <button class="btn" onclick="startQuiz('unit1')">B·∫Øt ƒë·∫ßu l√†m b√†i</button>
                    </div>
                    <!-- Test item 2 -->
                    <div class="test-item">
                        <div class="test-info">
                            <h3>ƒê·ªÅ thi gi·ªØa k·ª≥ 1</h3>
                            <p>Th·ªùi gian: 45 ph√∫t | S·ªë c√¢u h·ªèi: 15</p>
                        </div>
                        <button class="btn" onclick="startQuiz('midterm1')">B·∫Øt ƒë·∫ßu l√†m b√†i</button>
                    </div>
                    <!-- Test item 3 -->
                    <div class="test-item">
                        <div class="test-info">
                            <h3>ƒê·ªÅ ki·ªÉm tra t·ª´ v·ª±ng - Unit 1 & 2</h3>
                            <p>Th·ªùi gian: 15 ph√∫t | S·ªë c√¢u h·ªèi: 10</p>
                        </div>
                        <button class="btn" onclick="startQuiz('vocab1-2')">B·∫Øt ƒë·∫ßu l√†m b√†i</button>
                    </div>
                    <!-- M·ªöI: Test item 4 -->
                    <div class="test-item">
                        <div class="test-info">
                            <h3>ƒê·ªÅ ki·ªÉm tra 15 ph√∫t - Unit 3: Holiday</h3>
                            <p>Th·ªùi gian: 15 ph√∫t | S·ªë c√¢u h·ªèi: 10</p>
                        </div>
                        <button class="btn" onclick="startQuiz('unit3')">B·∫Øt ƒë·∫ßu l√†m b√†i</button>
                    </div>
                    <!-- M·ªöI: Test item 5 -->
                    <div class="test-item">
                        <div class="test-info">
                            <h3>ƒê·ªÅ ki·ªÉm tra 15 ph√∫t - Unit 4: Food</h3>
                            <p>Th·ªùi gian: 15 ph√∫t | S·ªë c√¢u h·ªèi: 10</p>
                        </div>
                        <button class="btn" onclick="startQuiz('unit4')">B·∫Øt ƒë·∫ßu l√†m b√†i</button>
                    </div>
                    <!-- Test item 6 (c≈© 4) -->
                    <div class="test-item">
                        <div class="test-info">
                            <h3>ƒê·ªÅ thi cu·ªëi k·ª≥ 1</h3>
                            <p>Th·ªùi gian: 60 ph√∫t | S·ªë c√¢u h·ªèi: 20</p>
                        </div>
                        <button class="btn" onclick="startQuiz('finalterm1')">B·∫Øt ƒë·∫ßu l√†m b√†i</button>
                    </div>
                    <!-- Test item 7 (c≈© 5) -->
                    <div class="test-item">
                        <div class="test-info">
                            <h3>ƒê·ªÅ thi gi·ªØa k·ª≥ 2</h3>
                            <p>Th·ªùi gian: 45 ph√∫t | S·ªë c√¢u h·ªèi: 15</p>
                        </div>
                        <button class="btn" onclick="startQuiz('midterm2')">B·∫Øt ƒë·∫ßu l√†m b√†i</button>
                    </div>
                </div>
            </div>
        </div> <!-- K·∫øt th√∫c #page-tests -->

        <!-- Trang 4: Game √în T·∫≠p (C·∫¨P NH·∫¨T: H√åNH ·∫¢NH) -->
        <div id="page-games" class="page">
            <div class="subpage-container">
                <h1>Game √în T·∫≠p Th√∫ V·ªã</h1>
                <div class="game-grid">
                    <!-- Game card 1 -->
                    <div class="game-card">
                        <img src="https://img.freepik.com/free-vector/memory-game-concept-illustration_114360-8431.jpg?w=740&t=st=1731310052~exp=1731310652~hmac=621743666d2146c8207908c69e8f49774d6c4422e1777218684eb2e91242337a" alt="Icon game L·∫≠t th·∫ª" onerror="this.src='https://placehold.co/300x150/fef2f2/dc2626?text=L·ªói+·∫¢nh'">
                        <div class="game-card-text">
                            <h3>L·∫≠t th·∫ª t·ª´ v·ª±ng</h3>
                            <button class="btn" onclick="startGame('flashcard')">Ch∆°i ngay</button>
                        </div>
                    </div>
                    <!-- Game card 2 -->
                    <div class="game-card">
                        <img src="https://img.freepik.com/free-vector/word-game-concept-illustration_114360-19200.jpg?w=740&t=st=1731310080~exp=1731310680~hmac=e907d08b350614838e12f9b88f34cc5110d7a7833acb86a117b0797960717b02" alt="Icon game N·ªëi t·ª´" onerror="this.src='https://placehold.co/300x150/fef2f2/dc2626?text=L·ªói+·∫¢nh'">
                        <div class="game-card-text">
                            <h3>N·ªëi t·ª´ (Word Connect)</h3>
                            <button class="btn" onclick="startGame('wordconnect')">Ch∆°i ngay</button>
                        </div>
                    </div>
                    <!-- Game card 3 -->
                    <div class="game-card">
                        <img src="https://img.freepik.com/free-vector/reading-concept-illustration_114360-1798.jpg?w=740&t=st=1731310113~exp=1731310713~hmac=50669b91705e81f14de2d91977926e8557c4c372f77341857948a43f8e4e9f73" alt="Icon game ƒêi·ªÅn t·ª´" onerror="this.src='https://placehold.co/300x150/fef2f2/dc2626?text=L·ªói+·∫¢nh'">
                        <div class="game-card-text">
                            <h3>ƒêi·ªÅn v√†o ch·ªó tr·ªëng</h3>
                            <button class="btn" onclick="startGame('fillblank')">Ch∆°i ngay</button>
                        </div>
                    </div>
                </div>
            </div>
        </div> <!-- K·∫øt th√∫c #page-games -->
        
        <!-- Trang 5: L√†m Quiz -->
        <div id="page-quiz" class="page">
            <div class="subpage-container">
                <button class="btn btn-back" onclick="showPage('tests')">&larr; Quay l·∫°i danh s√°ch ƒë·ªÅ</button>
                <h1 id="quiz-title">ƒê·ªÅ ki·ªÉm tra</h1>
                <div id="quiz-content">
                    <div id="quiz-question-container">
                        <p id="quiz-question" class="quiz-question-text"></p>
                    </div>
                    <div id="quiz-options" class="quiz-options-grid">
                        <!-- Options will be generated by JS -->
                    </div>
                    <button id="quiz-next-btn" class="btn" onclick="nextQuestion()">C√¢u ti·∫øp theo</button>
                </div>
                <div id="quiz-result" style="display: none;">
                    <h2>K·∫øt qu·∫£</h2>
                    <p id="quiz-score"></p>
                    <button class="btn" onclick="showPage('tests')">Ho√†n th√†nh</button>
                </div>
            </div>
        </div> <!-- K·∫øt th√∫c #page-quiz -->

        <!-- Trang 6: Game L·∫≠t Th·∫ª -->
        <div id="page-game-flashcard" class="page">
            <div class="subpage-container">
                <button class="btn btn-back" onclick="showPage('games')">&larr; Quay l·∫°i danh s√°ch game</button>
                <h1>Game: L·∫≠t th·∫ª t·ª´ v·ª±ng</h1>
                <div class="flashcard-controls">
                    <p>S·ªë l·∫ßn l·∫≠t: <strong id="flashcard-flips" class="text-xl text-primary-DEFAULT">0</strong></p>
                    <button class="btn" onclick="initFlashcardGame()">Ch∆°i l·∫°i</button>
                </div>
                <div id="flashcard-grid" class="flashcard-grid-container">
                    <!-- Cards will be generated by JS -->
                </div>
            </div>
        </div> <!-- K·∫øt th√∫c #page-game-flashcard -->
        
        <!-- Trang 6.1: Game N·ªëi T·ª´ -->
        <div id="page-game-wordconnect" class="page">
            <div class="subpage-container">
                <button class="btn btn-back" onclick="showPage('games')">&larr; Quay l·∫°i danh s√°ch game</button>
                <h1>Game: N·ªëi t·ª´</h1>
                <p id="wc-level-info" style="text-align: center;">Level 1</p>
                <div class="wc-game-area">
                    <div id="wc-found-words">
                        <h3>T·ª´ ƒë√£ t√¨m th·∫•y</h3>
                        <ul id="wc-found-list">
                            <!-- JS s·∫Ω ƒëi·ªÅn v√†o ƒë√¢y -->
                        </ul>
                    </div>
                    <div class="wc-grid-container">
                        <div id="wc-grid">
                            <!-- JS s·∫Ω t·∫°o l∆∞·ªõi ch·ªØ -->
                        </div>
                        <div id="wc-current-word"></div>
                        <div class="wc-controls">
                            <button id="wc-shuffle-btn" class="btn btn-back">Tr·ªôn ch·ªØ</button>
                            <button id="wc-next-level-btn" class="btn" style="display: none;">Level ti·∫øp theo</button>
                        </div>
                    </div>
                </div>
            </div>
        </div> <!-- K·∫øt th√∫c #page-game-wordconnect -->

        <!-- Trang 6.2: Game ƒêi·ªÅn v√†o ch·ªó tr·ªëng -->
        <div id="page-game-fillblank" class="page">
            <div class="subpage-container">
                <button class="btn btn-back" onclick="showPage('games')">&larr; Quay l·∫°i danh s√°ch game</button>
                <h1>Game: ƒêi·ªÅn v√†o ch·ªó tr·ªëng</h1>
                
                <div id="fb-game-area" class="fb-game-container">
                    <p id="fb-progress">C√¢u 1 / 10</p>
                    <div id="fb-sentence-container">
                        <span id="fb-sentence-start"></span>
                        <input type="text" id="fb-input" autocomplete="off" autocorrect="off">
                        <span id="fb-sentence-end"></span>
                    </div>
                    <button id="fb-check-btn" class="btn">Ki·ªÉm tra</button>
                    <div id="fb-feedback"></div>
                </div>

                <div id="fb-results" class="fb-game-container" style="display: none;">
                    <h2>Ho√†n th√†nh!</h2>
                    <p id="fb-results-score">B·∫°n ƒë√∫ng 0 / 10 c√¢u.</p>
                    <button id="fb-restart-btn" class="btn">Ch∆°i l·∫°i</button>
                </div>

            </div>
        </div> <!-- K·∫øt th√∫c #page-game-fillblank -->


        <!-- Trang 7: ƒêƒÉng nh·∫≠p -->
        <div id="page-login" class="page">
            <div class="auth-form-container">
                <form id="login-form">
                    <h1 style="text-align: center;">ƒêƒÉng nh·∫≠p</h1>
                    <div id="login-message" class="auth-message"></div>
                    <div class="form-group">
                        <label for="login-email">Email</label>
                        <input type="email" id="login-email" required>
                    </div>
                    <div class="form-group">
                        <label for="login-password">M·∫≠t kh·∫©u</label>
                        <input type="password" id="login-password" required>
                    </div>
                    <button type="submit" class="btn">ƒêƒÉng nh·∫≠p</button>
                    <div class="auth-switch">
                        Ch∆∞a c√≥ t√†i kho·∫£n? <a onclick="showPage('register')">ƒêƒÉng k√Ω ngay</a>
                    </div>
                </form>
            </div>
        </div> <!-- K·∫øt th√∫c #page-login -->

        <!-- Trang 8: ƒêƒÉng k√Ω -->
        <div id="page-register" class="page">
            <div class="auth-form-container">
                <form id="register-form">
                    <h1 style="text-align: center;">ƒêƒÉng k√Ω</h1>
                    <div id="register-message" class="auth-message"></div>
                    <div class="form-group">
                        <label for="reg-email">Email</label>
                        <input type="email" id="reg-email" required>
                    </div>
                    <div class="form-group">
                        <label for="reg-password">M·∫≠t kh·∫©u</label>
                        <input type="password" id="reg-password" required>
                    </div>
                    <div class="form-group">
                        <label for="reg-confirm-password">X√°c nh·∫≠n m·∫≠t kh·∫©u</label>
                        <input type="password" id="reg-confirm-password" required>
                    </div>
                    <button type="submit" class="btn">ƒêƒÉng k√Ω</button>
                    <div class="auth-switch">
                        ƒê√£ c√≥ t√†i kho·∫£n? <a onclick="showPage('login')">ƒêƒÉng nh·∫≠p</a>
                    </div>
                </form>
            </div>
        </div> <!-- K·∫øt th√∫c #page-register -->

        <!-- Trang 9: Cambridge (C·∫¨P NH·∫¨T: TH√äM UNITS & H√åNH ·∫¢NH) -->
        <div id="page-cambridge" class="page">
            <div class="subpage-container">
                <h1>Ch∆∞∆°ng tr√¨nh Cambridge</h1>
                <p style="text-align: center; max-width: 800px; margin: 0 auto 30px;" class="text-slate-600">
                    N·ªôi dung h·ªçc t·∫≠p b√°m s√°t ch∆∞∆°ng tr√¨nh Cambridge Primary. Luy·ªán t·∫≠p t·ª´ v·ª±ng, ng·ªØ ph√°p v√† c√°c k·ªπ nƒÉng nghe, n√≥i, ƒë·ªçc, vi·∫øt theo t·ª´ng Unit.
                </p>
                <div class="content-grid">
                    <!-- Unit Item 1 -->
                    <div class="content-item">
                        <img src="https://img.freepik.com/free-vector/children-reading-books-classroom_1308-111100.jpg?w=996&t=st=1731310344~exp=1731310944~hmac=b5643a6d90d70da15714c38234676527582b1b7024227f3006d649987814b7aa" alt="Unit 1: Our School" onerror="this.src='https://placehold.co/300x150/fef2f2/dc2626?text=L·ªói+·∫¢nh'">
                        <div class="content-item-text">
                            <h3>Unit 1: Our School <span class="completion-icon" id="icon-cambridge-unit1"></span></h3>
                            <p class="text-slate-500 text-sm">T·ª´ v·ª±ng v·ªÅ tr∆∞·ªùng h·ªçc, c√°c m√¥n h·ªçc v√† ho·∫°t ƒë·ªông.</p>
                            <button class="btn" onclick="showPage('cambridge-unit1', 'cambridge')">V√†o h·ªçc</button>
                        </div>
                    </div>
                    <!-- Unit Item 2 -->
                    <div class="content-item">
                        <img src="https://img.freepik.com/free-vector/happy-family-theme_23-2148946220.jpg?w=826&t=st=1731310377~exp=1731310977~hmac=a48ef89f36b69b82874136656885e33d26002ca16e680e07fa1f2f8405d5c077" alt="Unit 2: Family and Friends" onerror="this.src='https://placehold.co/300x150/fef2f2/dc2626?text=L·ªói+·∫¢nh'">
                        <div class="content-item-text">
                            <h3>Unit 2: Family and Friends <span class="completion-icon" id="icon-cambridge-unit2"></span></h3>
                            <p class="text-slate-500 text-sm">T·ª´ v·ª±ng v·ªÅ gia ƒë√¨nh, b·∫°n b√® v√† c√°c m·ªëi quan h·ªá.</p>
                            <button class="btn" onclick="showPage('cambridge-unit2', 'cambridge')">V√†o h·ªçc</button>
                        </div>
                    </div>
                    <!-- Unit Item 3 -->
                    <div class="content-item">
                        <img src="https://img.freepik.com/free-vector/hand-drawn-world-environment-day-illustration_23-2148937962.jpg?w=996&t=st=1731310410~exp=1731311010~hmac=dae8d38865ed3b4f620e4eb1e62635951d8b2d1858a7da7c570b77fa8f6424e4" alt="Unit 3: The World Around Us" onerror="this.src='https://placehold.co/300x150/fef2f2/dc2626?text=L·ªói+·∫¢nh'">
                        <div class="content-item-text">
                            <h3>Unit 3: The World Around Us <span class="completion-icon" id="icon-cambridge-unit3"></span></h3>
                            <p class="text-slate-500 text-sm">Kh√°m ph√° th·∫ø gi·ªõi t·ª± nhi√™n, ƒë·ªông v·∫≠t v√† m√¥i tr∆∞·ªùng.</p>
                            <button class="btn" onclick="showPage('cambridge-unit3', 'cambridge')">V√†o h·ªçc</button>
                        </div>
                    </div>
                    <!-- M·ªöI: Unit Item 4 -->
                    <div class="content-item">
                        <img src="https://img.freepik.com/free-vector/physical-activity-healthy-lifestyle-recreation-leisure-children-exercising-doing-sports-cartoon-characters-kids-playing-outdoors-vector-isolated-concept-metaphor-illustration_335657-2122.jpg?w=996&t=st=1731310452~exp=1731311052~hmac=7a591e604f7c134015c6130d22380d0d84457e3f2268fa3d420a969f6e693175" alt="Unit 4: Health and Habits" onerror="this.src='https://placehold.co/300x150/fef2f2/dc2626?text=L·ªói+·∫¢nh'">
                        <div class="content-item-text">
                            <h3>Unit 4: S·ª©c kh·ªèe & Th√≥i quen <span class="completion-icon" id="icon-cambridge-unit4"></span></h3>
                            <p class="text-slate-500 text-sm">H·ªçc v·ªÅ c∆° th·ªÉ, ƒë·ªì ƒÉn t·ªët cho s·ª©c kh·ªèe v√† th√≥i quen t·ªët.</p>
                            <button class="btn" onclick="showPage('cambridge-unit4', 'cambridge')">V√†o h·ªçc</button>
                        </div>
                    </div>
                    <!-- M·ªöI: Unit Item 5 -->
                    <div class="content-item">
                        <img src="https://img.freepik.com/free-vector/city-life-scene-with-people-walking-doing-activities-front-shops_179970-652.jpg?w=996&t=st=1731310486~exp=1731311086~hmac=e2023d8c199589d6e27303d8d5dfd1f114631d87e0892095cc19ce925695ab82" alt="Unit 5: My Town" onerror="this.src='https://placehold.co/300x150/fef2f2/dc2626?text=L·ªói+·∫¢nh'">
                        <div class="content-item-text">
                            <h3>Unit 5: Th·ªã tr·∫•n c·ªßa t√¥i <span class="completion-icon" id="icon-cambridge-unit5"></span></h3>
                            <p class="text-slate-500 text-sm">C√°c ƒë·ªãa ƒëi·ªÉm trong th·ªã tr·∫•n: c·ª≠a h√†ng, tr·∫°m xe, c√¥ng vi√™n.</p>
                            <button class="btn" onclick="showPage('cambridge-unit5', 'cambridge')">V√†o h·ªçc</button>
                        </div>
                    </div>
                    <!-- M·ªöI: Unit Item 6 -->
                    <div class="content-item">
                        <img src="https://img.freepik.com/free-vector/summer-kids_10308-142.jpg?w=740&t=st=1731310515~exp=1731311115~hmac=b8801d011118fa30f1ec373c05903b44b8296a63583c21a11584c2f82c499f5d" alt="Unit 6: Holidays and Travel" onerror="this.src='https://placehold.co/300x150/fef2f2/dc2626?text=L·ªói+·∫¢nh'">
                        <div class="content-item-text">
                            <h3>Unit 6: K·ª≥ ngh·ªâ & Du l·ªãch <span class="completion-icon" id="icon-cambridge-unit6"></span></h3>
                            <p class="text-slate-500 text-sm">C√°c ho·∫°t ƒë·ªông trong k·ª≥ ngh·ªâ, ph∆∞∆°ng ti·ªán ƒëi l·∫°i.</p>
                            <button class="btn" onclick="showPage('cambridge-unit6', 'cambridge')">V√†o h·ªçc</button>
                        </div>
                    </div>
                </div>
            </div>
        </div> <!-- K·∫øt th√∫c #page-cambridge -->

        <!-- Trang 10: Global Success (C·∫¨P NH·∫¨T: TH√äM UNITS & H√åNH ·∫¢NH) -->
        <div id="page-globalsuccess" class="page">
            <div class="subpage-container">
                <h1>Ch∆∞∆°ng tr√¨nh Global Success (L·ªõp 5)</h1>
                <p style="text-align: center; max-width: 800px; margin: 0 auto 30px;" class="text-slate-600">
                    T·ªïng h·ª£p t·ª´ v·ª±ng v√† ng·ªØ ph√°p theo S√°ch gi√°o khoa Ti·∫øng Anh 5 - Global Success. Luy·ªán t·∫≠p theo t·ª´ng ƒë∆°n v·ªã b√†i h·ªçc.
                </p>
                <div class="content-grid">
                    <!-- Unit Item 1 -->
                    <div class="content-item">
                        <img src="https://img.freepik.com/free-vector/street-view-scene-with-many-shops-road_1308-56837.jpg?w=996&t=st=1731310574~exp=1731311174~hmac=d243a411cf7178c78ccb21c439169647206132039a7b51e06d9d1e1f133e9d72" alt="Unit 1: What's your address?" onerror="this.src='https://placehold.co/300x150/fef2f2/dc2626?text=L·ªói+·∫¢nh'">
                        <div class="content-item-text">
                            <h3>Unit 1: What's your address? <span class="completion-icon" id="icon-globalsuccess-unit1"></span></h3>
                            <p class="text-slate-500 text-sm">H·ªçc c√°ch h·ªèi v√† tr·∫£ l·ªùi v·ªÅ ƒë·ªãa ch·ªâ.</p>
                            <button class="btn" onclick="showPage('globalsuccess-unit1', 'globalsuccess')">V√†o h·ªçc</button>
                        </div>
                    </div>
                    <!-- Unit Item 2 -->
                    <div class="content-item">
                        <img src="https://img.freepik.com/free-vector/daily-routine-concept-illustration_114360-7043.jpg?w=740&t=st=1731310609~exp=1731311209~hmac=553c3e21ef28fcc2bc2a4e21a8f9b7c8911f99c852445e994e63d6b05be3b6aa" alt="Unit 2: I always get up early" onerror="this.src='https://placehold.co/300x150/fef2f2/dc2626?text=L·ªói+·∫¢nh'">
                         <div class="content-item-text">
                            <h3>Unit 2: I always get up early <span class="completion-icon" id="icon-globalsuccess-unit2"></span></h3>
                            <p class="text-slate-500 text-sm">N√≥i v·ªÅ c√°c th√≥i quen v√† ho·∫°t ƒë·ªông h√†ng ng√†y.</p>
                            <button class="btn" onclick="showPage('globalsuccess-unit2', 'globalsuccess')">V√†o h·ªçc</button>
                        </div>
                    </div>
                    <!-- Unit Item 3 -->
                    <div class="content-item">
                        <img src="https://img.freepik.com/free-vector/ha-long-bay-landscape-scene_1308-58137.jpg?w=996&t=st=1731310639~exp=1731311239~hmac=298066f1082c49e2954a67ed9d74a1239857d4b04f767c2963d08f7ce6231c50" alt="Unit 3: Where did you go on holiday?" onerror="this.src='https://placehold.co/300x150/fef2f2/dc2626?text=L·ªói+·∫¢nh'">
                        <div class="content-item-text">
                            <h3>Unit 3: Where did you go... <span class="completion-icon" id="icon-globalsuccess-unit3"></span></h3>
                            <p class="text-slate-500 text-sm">H·ªçc c√°ch n√≥i v·ªÅ c√°c k·ª≥ ngh·ªâ (Th√¨ qu√° kh·ª© ƒë∆°n).</p>
                            <button class="btn" onclick="showPage('globalsuccess-unit3', 'globalsuccess')">V√†o h·ªçc</button>
                        </div>
                    </div>
                    <!-- M·ªöI: Unit Item 4 -->
                    <div class="content-item">
                        <img src="https://img.freepik.com/free-vector/children-birthday-party-concept_23-2148480577.jpg?w=996&t=st=1731310680~exp=1731311280~hmac=b7e28321041b34e402b8d4e44f83b163d76e771d9990566371cf7394c8651084" alt="Unit 4: Did you go to the party?" onerror="this.src='https://placehold.co/300x150/fef2f2/dc2626?text=L·ªói+·∫¢nh'">
                        <div class="content-item-text">
                            <h3>Unit 4: Did you go to the party? <span class="completion-icon" id="icon-globalsuccess-unit4"></span></h3>
                            <p class="text-slate-500 text-sm">N√≥i v·ªÅ c√°c b·ªØa ti·ªác v√† ho·∫°t ƒë·ªông trong qu√° kh·ª©.</p>
                            <button class="btn" onclick="showPage('globalsuccess-unit4', 'globalsuccess')">V√†o h·ªçc</button>
                        </div>
                    </div>
                    <!-- M·ªöI: Unit Item 5 -->
                    <div class="content-item">
                        <img src="https://img.freepik.com/free-vector/group-people-different-professions_1308-66268.jpg?w=996&t=st=1731310714~exp=1731311314~hmac=b6f63f58a36c61f238a0f2690a2c0f64c126d4002e21262d1421ab29c3f0c333" alt="Unit 5: What will you be in the future?" onerror="this.src='https://placehold.co/300x150/fef2f2/dc2626?text=L·ªói+·∫¢nh'">
                        <div class="content-item-text">
                            <h3>Unit 5: What will you be... <span class="completion-icon" id="icon-globalsuccess-unit5"></span></h3>
                            <p class="text-slate-500 text-sm">H·ªèi v√† tr·∫£ l·ªùi v·ªÅ ngh·ªÅ nghi·ªáp trong t∆∞∆°ng lai.</p>
                            <button class="btn" onclick="showPage('globalsuccess-unit5', 'globalsuccess')">V√†o h·ªçc</button>
                        </div>
                    </div>
                    <!-- M·ªöI: Unit Item 6 -->
                    <div class="content-item">
                        <img src="https://img.freepik.com/free-vector/boy-playing-different-sports_1308-31626.jpg?w=740&t=st=1731310747~exp=1731311347~hmac=b7f5f84d092923768393c907b1373a6a978f85f368f56e9c946f007e94e24233" alt="Unit 6: How many lessons do you have today?" onerror="this.src='https://placehold.co/300x150/fef2f2/dc2626?text=L·ªói+·∫¢nh'">
                        <div class="content-item-text">
                            <h3>Unit 6: How many lessons... <span class="completion-icon" id="icon-globalsuccess-unit6"></span></h3>
                            <p class="text-slate-500 text-sm">N√≥i v·ªÅ c√°c m√¥n h·ªçc v√† th·ªùi kh√≥a bi·ªÉu.</p>
                            <button class="btn" onclick="showPage('globalsuccess-unit6', 'globalsuccess')">V√†o h·ªçc</button>
                        </div>
                    </div>
                </div>
            </div>
        </div> <!-- K·∫øt th√∫c #page-globalsuccess -->

        <!-- Trang 11: H·ªì s∆° -->
        <div id="page-profile" class="page">
            <div class="subpage-container">
                <h1>H·ªì s∆° c·ªßa b·∫°n</h1>
                
                <!-- Th√¥ng tin t√†i kho·∫£n -->
                <div class="lesson-section">
                    <h2>Th√¥ng tin t√†i kho·∫£n</h2>
                    <p>Email: <strong id="profile-email" class="text-primary-DEFAULT">...</strong></p>
                    <p>UserID: <strong id="profile-userid" class="text-slate-500 text-sm">...</strong></p>
                </div>
                
                <!-- C·∫≠p nh·∫≠t th√¥ng tin -->
                <div class="lesson-section">
                    <h2>C·∫≠p nh·∫≠t th√¥ng tin</h2>
                    <form id="profile-update-form">
                        <div id="profile-message" class="auth-message" style="display: none;"></div>
                        <div class="form-group">
                            <label for="profile-display-name">T√™n hi·ªÉn th·ªã</label>
                            <p class="text-sm text-slate-500 mb-2">T√™n n√†y s·∫Ω xu·∫•t hi·ªán tr√™n B·∫£ng x·∫øp h·∫°ng v√† trong c√°c B√¨nh lu·∫≠n c·ªßa b·∫°n.</p>
                            <input type="text" id="profile-display-name" required minlength="3">
                        </div>
                        <button type="submit" class="btn">L∆∞u thay ƒë·ªïi</button>
                    </form>
                </div>
                
                <!-- Ti·∫øn ƒë·ªô Quiz -->
                <div class="lesson-section">
                    <h2>Ti·∫øn ƒë·ªô h·ªçc t·∫≠p (B√†i ki·ªÉm tra)</h2>
                    <div id="profile-quiz-results">
                        <p>Ch∆∞a c√≥ k·∫øt qu·∫£ n√†o ƒë∆∞·ª£c l∆∞u.</p>
                    </div>
                </div>
                
                <!-- Ti·∫øn ƒë·ªô b√†i h·ªçc -->
                <div class="lesson-section">
                    <h2>Ti·∫øn ƒë·ªô b√†i h·ªçc (ƒê√£ ho√†n th√†nh)</h2>
                    <div id="profile-lesson-progress">
                        <p>Ch∆∞a ho√†n th√†nh b√†i h·ªçc n√†o.</p>
                    </div>
                </div>

                <button class="btn btn-back" id="profile-logout-btn" onclick="handleLogout(event)">ƒêƒÉng xu·∫•t</button>
            </div>
        </div> <!-- K·∫øt th√∫c #page-profile -->
        
        <!-- Trang 12: B·∫£ng X·∫øp H·∫°ng -->
        <div id="page-leaderboard" class="page">
            <div class="subpage-container">
                <h1>B·∫£ng X·∫øp H·∫°ng</h1>
                <p style="text-align: center; max-width: 800px; margin: 0 auto 30px;" class="text-slate-600">
                    Th√†nh t√≠ch c·ªßa c√°c h·ªçc sinh c√≥ ƒëi·ªÉm cao nh·∫•t. ƒêi·ªÉm ƒë∆∞·ª£c t√≠nh t·ª´ c√°c b√†i ki·ªÉm tra (Quiz) v√† game (ƒêi·ªÅn v√†o ch·ªó tr·ªëng).
                </p>
                <div id="leaderboard-table-container">
                    <p id="leaderboard-loading">ƒêang t·∫£i b·∫£ng x·∫øp h·∫°ng...</p>
                </div>
            </div>
        </div> <!-- K·∫øt th√∫c #page-leaderboard -->

        <!-- TRANG B√ÄI H·ªåC -->

        <!-- Cambridge Unit 1 (C·∫¨P NH·∫¨T: N·ªòI DUNG PHONG PH√ö H∆†N) -->
        <div id="page-cambridge-unit1" class="page">
            <div class="subpage-container">
                <button class="btn btn-back" onclick="showPage('cambridge', 'cambridge')">&larr; Quay l·∫°i Cambridge</button>
                <h1>Cambridge - Unit 1: Our School</h1>
                
                <!-- C·∫¨P NH·∫¨T: B·ªê C·ª§C T·ª™ V·ª∞NG M·ªöI -->
                <div class="lesson-section">
                    <h2>1. T·ª´ v·ª±ng (Vocabulary)</h2>
                    <ul class="vocab-list">
                        <li class="vocab-item">
                            <img src="https://img.freepik.com/free-vector/empty-school-classroom-interior-education-background_1308-111103.jpg?w=996&t=st=1731311029~exp=1731311629~hmac=5ed7c936720817ac2cf62e0c946c7ccb8a07c33c09b30c144c100347854be705" alt="Classroom" onerror="this.src='https://placehold.co/200x120/fef2f2/dc2626?text=L·ªói+·∫¢nh'">
                            <strong>Classroom (n)</strong>
                            <p>L·ªõp h·ªçc</p>
                        </li>
                        <li class="vocab-item">
                            <img src="https://img.freepik.com/free-vector/library-interior-with-books-shelves_107791-1934.jpg?w=996&t=st=1731311051~exp=1731311651~hmac=02e88a3857e4e16d414a9c14830154bc85cae6097d75c92f9d863e4811a43a01" alt="Library" onerror="this.src='https://placehold.co/200x120/fef2f2/dc2626?text=L·ªói+·∫¢nh'">
                            <strong>Library (n)</strong>
                            <p>Th∆∞ vi·ªán</p>
                        </li>
                        <li class="vocab-item">
                            <img src="https://img.freepik.com/free-vector/school-gym-interior-cartoon-style_1308-111101.jpg?w=996&t=st=1731311073~exp=1731311673~hmac=80393049219e2764b88939b02f89f7f0227c81d86d6eb5264b32524f7ca83626" alt="Gym" onerror="this.src='https://placehold.co/200x120/fef2f2/dc2626?text=L·ªói+·∫¢nh'">
                            <strong>Gym (n)</strong>
                            <p>Ph√≤ng t·∫≠p th·ªÉ d·ª•c</p>
                        </li>
                        <li class="vocab-item">
                            <img src="https://img.freepik.com/free-vector/kids-playground-park_1308-30623.jpg?w=996&t=st=1731311094~exp=1731311694~hmac=41e247b973c9f20e4b9bc972986427320092c43105a30644a864e292a832f059" alt="Playground" onerror="this.src='https://placehold.co/200x120/fef2f2/dc2626?text=L·ªói+·∫¢nh'">
                            <strong>Playground (n)</strong>
                            <p>S√¢n ch∆°i</p>
                        </li>
                         <li class="vocab-item">
                            <img src="https://img.freepik.com/free-vector/hand-drawn-english-subject-illustration_23-2150009623.jpg?w=740&t=st=1731311124~exp=1731311724~hmac=d88072023d6a2a0eb921c5b8b9af997d91e84df9af86a87752e257b45a27814b" alt="Subject" onerror="this.src='https://placehold.co/200x120/fef2f2/dc2626?text=L·ªói+·∫¢nh'">
                            <strong>Subject (n)</strong>
                            <p>M√¥n h·ªçc</p>
                        </li>
                         <li class="vocab-item">
                            <img src="https://img.freepik.com/free-vector/hand-drawn-science-education-illustration_23-2149495408.jpg?w=740&t=st=1731311145~exp=1731311745~hmac=edb708b79f2910d6a2a048705f1f94d35166299f061e8697da47907577536341" alt="Science" onerror="this.src='https://placehold.co/200x120/fef2f2/dc2626?text=L·ªói+·∫¢nh'">
                            <strong>Science (n)</strong>
                            <p>M√¥n Khoa h·ªçc</p>
                        </li>
                    </ul>
                </div>
                <div class="lesson-section">
                    <h2>2. Ng·ªØ ph√°p (Grammar)</h2>
                    <p><strong>C·∫•u tr√∫c 1: What subject do you have today?</strong> (H√¥m nay b·∫°n c√≥ m√¥n g√¨?)</p>
                    <p>Tr·∫£ l·ªùi: I have + (t√™n m√¥n h·ªçc).</p>
                    <p>V√≠ d·ª•: I have Maths, Vietnamese, and English.</p>
                </div>
                <!-- M·ªöI: M·∫™U C√ÇU HAY -->
                <div class="lesson-section">
                    <h2>3. M·∫´u c√¢u hay (Useful Sentences)</h2>
                    <ul>
                        <li>This is our new classroom. (ƒê√¢y l√† l·ªõp h·ªçc m·ªõi c·ªßa ch√∫ng ta.)</li>
                        <li>The library is very big. (Th∆∞ vi·ªán r·∫•t l·ªõn.)</li>
                        <li>We play football in the gym. (Ch√∫ng t·ªõ ch∆°i ƒë√° banh trong ph√≤ng th·ªÉ d·ª•c.)</li>
                        <li>What is your favourite subject? (M√¥n h·ªçc y√™u th√≠ch c·ªßa b·∫°n l√† g√¨?)</li>
                    </ul>
                </div>
                
                <button class="btn btn-complete" onclick="markLessonComplete('cambridge-unit1')">Ho√†n th√†nh b√†i h·ªçc</button>

                <div class="lesson-section comment-section">
                    <h2>B√¨nh lu·∫≠n</h2>
                    <div id="comment-list-cambridge-unit1" class="comment-list">
                        <!-- Comments load here -->
                    </div>
                    <form id="comment-form-cambridge-unit1" class="comment-form" onsubmit="event.preventDefault(); postComment('cambridge-unit1');">
                        <textarea id="comment-input-cambridge-unit1" placeholder="Vi·∫øt b√¨nh lu·∫≠n c·ªßa b·∫°n..." required></textarea>
                        <button type="submit" class="btn">G·ª≠i</button>
                    </form>
                </div>
                
            </div>
        </div>
        <!-- Cambridge Unit 2 -->
        <div id="page-cambridge-unit2" class="page">
            <div class="subpage-container">
                <button class="btn btn-back" onclick="showPage('cambridge', 'cambridge')">&larr; Quay l·∫°i Cambridge</button>
                <h1>Cambridge - Unit 2: Family and Friends</h1>
                <div class="lesson-section"><h2>N·ªôi dung Unit 2 ƒëang ƒë∆∞·ª£c c·∫≠p nh·∫≠t...</h2></div>
                
                <button class="btn btn-complete" onclick="markLessonComplete('cambridge-unit2')">Ho√†n th√†nh b√†i h·ªçc</button>

                <div class="lesson-section comment-section">
                    <h2>B√¨nh lu·∫≠n</h2>
                    <div id="comment-list-cambridge-unit2" class="comment-list"></div>
                    <form id="comment-form-cambridge-unit2" class="comment-form" onsubmit="event.preventDefault(); postComment('cambridge-unit2');">
                        <textarea id="comment-input-cambridge-unit2" placeholder="Vi·∫øt b√¨nh lu·∫≠n c·ªßa b·∫°n..." required></textarea>
                        <button type="submit" class="btn">G·ª≠i</button>
                    </form>
                </div>
            </div>
        </div>
        <!-- Cambridge Unit 3 -->
        <div id="page-cambridge-unit3" class="page">
            <div class="subpage-container">
                <button class="btn btn-back" onclick="showPage('cambridge', 'cambridge')">&larr; Quay l·∫°i Cambridge</button>
                <h1>Cambridge - Unit 3: The World Around Us</h1>
                <div class="lesson-section"><h2>N·ªôi dung Unit 3 ƒëang ƒë∆∞·ª£c c·∫≠p nh·∫≠t...</h2></div>
                
                <button class="btn btn-complete" onclick="markLessonComplete('cambridge-unit3')">Ho√†n th√†nh b√†i h·ªçc</button>
                <div class="lesson-section comment-section">
                    <h2>B√¨nh lu·∫≠n</h2>
                    <div id="comment-list-cambridge-unit3" class="comment-list"></div>
                    <form id="comment-form-cambridge-unit3" class="comment-form" onsubmit="event.preventDefault(); postComment('cambridge-unit3');">
                        <textarea id="comment-input-cambridge-unit3" placeholder="Vi·∫øt b√¨nh lu·∫≠n c·ªßa b·∫°n..." required></textarea>
                        <button type="submit" class="btn">G·ª≠i</button>
                    </form>
                </div>
            </div>
        </div>
        <!-- M·ªöI: Cambridge Unit 4 -->
        <div id="page-cambridge-unit4" class="page">
            <div class="subpage-container">
                <button class="btn btn-back" onclick="showPage('cambridge', 'cambridge')">&larr; Quay l·∫°i Cambridge</button>
                <h1>Cambridge - Unit 4: S·ª©c kh·ªèe & Th√≥i quen</h1>
                <div class="lesson-section"><h2>N·ªôi dung Unit 4 ƒëang ƒë∆∞·ª£c c·∫≠p nh·∫≠t...</h2></div>
                <button class="btn btn-complete" onclick="markLessonComplete('cambridge-unit4')">Ho√†n th√†nh b√†i h·ªçc</button>
                <div class="lesson-section comment-section">
                    <h2>B√¨nh lu·∫≠n</h2>
                    <div id="comment-list-cambridge-unit4" class="comment-list"></div>
                    <form id="comment-form-cambridge-unit4" class="comment-form" onsubmit="event.preventDefault(); postComment('cambridge-unit4');">
                        <textarea id="comment-input-cambridge-unit4" placeholder="Vi·∫øt b√¨nh lu·∫≠n c·ªßa b·∫°n..." required></textarea>
                        <button type="submit" class="btn">G·ª≠i</button>
                    </form>
                </div>
            </div>
        </div>
        <!-- M·ªöI: Cambridge Unit 5 -->
        <div id="page-cambridge-unit5" class="page">
            <div class="subpage-container">
                <button class="btn btn-back" onclick="showPage('cambridge', 'cambridge')">&larr; Quay l·∫°i Cambridge</button>
                <h1>Cambridge - Unit 5: Th·ªã tr·∫•n c·ªßa t√¥i</h1>
                <div class="lesson-section"><h2>N·ªôi dung Unit 5 ƒëang ƒë∆∞·ª£c c·∫≠p nh·∫≠t...</h2></div>
                <button class="btn btn-complete" onclick="markLessonComplete('cambridge-unit5')">Ho√†n th√†nh b√†i h·ªçc</button>
                <div class="lesson-section comment-section">
                    <h2>B√¨nh lu·∫≠n</h2>
                    <div id="comment-list-cambridge-unit5" class="comment-list"></div>
                    <form id="comment-form-cambridge-unit5" class="comment-form" onsubmit="event.preventDefault(); postComment('cambridge-unit5');">
                        <textarea id="comment-input-cambridge-unit5" placeholder="Vi·∫øt b√¨nh lu·∫≠n c·ªßa b·∫°n..." required></textarea>
                        <button type="submit" class="btn">G·ª≠i</button>
                    </form>
                </div>
            </div>
        </div>
        <!-- M·ªöI: Cambridge Unit 6 -->
        <div id="page-cambridge-unit6" class="page">
            <div class="subpage-container">
                <button class="btn btn-back" onclick="showPage('cambridge', 'cambridge')">&larr; Quay l·∫°i Cambridge</button>
                <h1>Cambridge - Unit 6: K·ª≥ ngh·ªâ & Du l·ªãch</h1>
                <div class="lesson-section"><h2>N·ªôi dung Unit 6 ƒëang ƒë∆∞·ª£c c·∫≠p nh·∫≠t...</h2></div>
                <button class="btn btn-complete" onclick="markLessonComplete('cambridge-unit6')">Ho√†n th√†nh b√†i h·ªçc</button>
                <div class="lesson-section comment-section">
                    <h2>B√¨nh lu·∫≠n</h2>
                    <div id="comment-list-cambridge-unit6" class="comment-list"></div>
                    <form id="comment-form-cambridge-unit6" class="comment-form" onsubmit="event.preventDefault(); postComment('cambridge-unit6');">
                        <textarea id="comment-input-cambridge-unit6" placeholder="Vi·∫øt b√¨nh lu·∫≠n c·ªßa b·∫°n..." required></textarea>
                        <button type="submit" class="btn">G·ª≠i</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Global Success Unit 1 (C·∫¨P NH·∫¨T: N·ªòI DUNG PHONG PH√ö H∆†N) -->
        <div id="page-globalsuccess-unit1" class="page">
            <div class="subpage-container">
                <button class="btn btn-back" onclick="showPage('globalsuccess', 'globalsuccess')">&larr; Quay l·∫°i Global Success</button>
                <h1>Global Success - Unit 1: What's your address?</h1>
                <!-- C·∫¨P NH·∫¨T: B·ªê C·ª§C T·ª™ V·ª∞NG M·ªöI -->
                <div class="lesson-section">
                    <h2>1. T·ª´ v·ª±ng (Vocabulary)</h2>
                    <ul class="vocab-list">
                        <li class="vocab-item">
                            <img src="https://img.freepik.com/free-vector/hand-drawn-map-concept_23-2148099309.jpg?w=740&t=st=1731311394~exp=1731311994~hmac=62d5e7529fa0331003f901a1829e1cd4da80c98f8cc4294ed05b22301c37c22e" alt="Address" onerror="this.src='https://placehold.co/200x120/fef2f2/dc2626?text=L·ªói+·∫¢nh'">
                            <strong>Address (n)</strong>
                            <p>ƒê·ªãa ch·ªâ</p>
                        </li>
                        <li class="vocab-item">
                            <img src="https://img.freepik.com/free-vector/empty-street-night-scene_1308-54812.jpg?w=996&t=st=1731311417~exp=1731312017~hmac=e2098670da4162ab317822e11e06c4b9f29913197623a9a557b447a16f5c88ea" alt="Street" onerror="this.src='https://placehold.co/200x120/fef2f2/dc2626?text=L·ªói+·∫¢nh'">
                            <strong>Street (n)</strong>
                            <p>ƒê∆∞·ªùng ph·ªë</p>
                        </li>
                        <li class="vocab-item">
                            <img src="https://img.freepik.com/free-vector/rural-landscape-concept-illustration_114360-9222.jpg?w=996&t=st=1731311438~exp=1731312038~hmac=4dfa8b0870c57c5040f1a9a8383a8bce69123fa3b455b8e99908cf69a23d062e" alt="Village" onerror="this.src='https://placehold.co/200x120/fef2f2/dc2626?text=L·ªói+·∫¢nh'">
                            <strong>Village (n)</strong>
                            <p>L√†ng, x√£</p>
                        </li>
                        <li class="vocab-item">
                            <img src="https://img.freepik.com/free-vector/city-skyline-concept-illustration_114360-8962.jpg?w=996&t=st=1731311458~exp=1731312058~hmac=3c9f28d7a18f8885b54203df5cae4c0ea2542a20a6e4313f8c8541e2b5c010b9" alt="City" onerror="this.src='https://placehold.co/200x120/fef2f2/dc2626?text=L·ªói+·∫¢nh'">
                            <strong>City (n)</strong>
                            <p>Th√†nh ph·ªë</p>
                        </li>
                    </ul>
                </div>
                <div class="lesson-section">
                    <h2>2. Ng·ªØ ph√°p (Grammar)</h2>
                    <p><strong>C·∫•u tr√∫c: What's your address?</strong> (ƒê·ªãa ch·ªâ c·ªßa b·∫°n l√† g√¨?)</p>
                    <p>Tr·∫£ l·ªùi: It's + (s·ªë nh√†) + (t√™n ƒë∆∞·ªùng).</p>
                    <p>V√≠ d·ª•: It's 123 Tran Hung Dao Street.</p>
                </div>
                 <!-- M·ªöI: M·∫™U C√ÇU HAY -->
                <div class="lesson-section">
                    <h2>3. M·∫´u c√¢u hay (Useful Sentences)</h2>
                    <ul>
                        <li>Where do you live? (B·∫°n s·ªëng ·ªü ƒë√¢u?)</li>
                        <li>I live at 81 Tran Hung Dao Street. (T√¥i s·ªëng ·ªü s·ªë 81 ƒë∆∞·ªùng Tr·∫ßn H∆∞ng ƒê·∫°o.)</li>
                        <li>I live in a big city. (T√¥i s·ªëng ·ªü m·ªôt th√†nh ph·ªë l·ªõn.)</li>
                        <li>My address is... (ƒê·ªãa ch·ªâ c·ªßa t√¥i l√†...)</li>
                    </ul>
                </div>
                
                <button class="btn btn-complete" onclick="markLessonComplete('globalsuccess-unit1')">Ho√†n th√†nh b√†i h·ªçc</button>
                <div class="lesson-section comment-section">
                    <h2>B√¨nh lu·∫≠n</h2>
                    <div id="comment-list-globalsuccess-unit1" class="comment-list"></div>
                    <form id="comment-form-globalsuccess-unit1" class="comment-form" onsubmit="event.preventDefault(); postComment('globalsuccess-unit1');">
                        <textarea id="comment-input-globalsuccess-unit1" placeholder="Vi·∫øt b√¨nh lu·∫≠n c·ªßa b·∫°n..." required></textarea>
                        <button type="submit" class="btn">G·ª≠i</button>
                    </form>
                </div>
            </div>
        </div>
        <!-- Global Success Unit 2 -->
        <div id="page-globalsuccess-unit2" class="page">
            <div class="subpage-container">
                <button class="btn btn-back" onclick="showPage('globalsuccess', 'globalsuccess')">&larr; Quay l·∫°i Global Success</button>
                <h1>Global Success - Unit 2: I always get up early</h1>
                <div class="lesson-section"><h2>N·ªôi dung Unit 2 ƒëang ƒë∆∞·ª£c c·∫≠p nh·∫≠t...</h2></div>
                
                <button class="btn btn-complete" onclick="markLessonComplete('globalsuccess-unit2')">Ho√†n th√†nh b√†i h·ªçc</button>
                <div class="lesson-section comment-section">
                    <h2>B√¨nh lu·∫≠n</h2>
                    <div id="comment-list-globalsuccess-unit2" class="comment-list"></div>
                    <form id="comment-form-globalsuccess-unit2" class="comment-form" onsubmit="event.preventDefault(); postComment('globalsuccess-unit2');">
                        <textarea id="comment-input-globalsuccess-unit2" placeholder="Vi·∫øt b√¨nh lu·∫≠n c·ªßa b·∫°n..." required></textarea>
                        <button type="submit" class="btn">G·ª≠i</button>
                    </form>
                </div>
            </div>
        </div>
        <!-- Global Success Unit 3 -->
        <div id="page-globalsuccess-unit3" class="page">
            <div class="subpage-container">
                <button class="btn btn-back" onclick="showPage('globalsuccess', 'globalsuccess')">&larr; Quay l·∫°i Global Success</button>
                <h1>Global Success - Unit 3: Where did you go on holiday?</h1>
                <div class="lesson-section"><h2>N·ªôi dung Unit 3 ƒëang ƒë∆∞·ª£c c·∫≠p nh·∫≠t...</h2></div>
                
                <button class="btn btn-complete" onclick="markLessonComplete('globalsuccess-unit3')">Ho√†n th√†nh b√†i h·ªçc</button>
                <div class="lesson-section comment-section">
                    <h2>B√¨nh lu·∫≠n</h2>
                    <div id="comment-list-globalsuccess-unit3" class="comment-list"></div>
                    <form id="comment-form-globalsuccess-unit3" class="comment-form" onsubmit="event.preventDefault(); postComment('globalsuccess-unit3');">
                        <textarea id="comment-input-globalsuccess-unit3" placeholder="Vi·∫øt b√¨nh lu·∫≠n c·ªßa b·∫°n..." required></textarea>
                        <button type="submit" class="btn">G·ª≠i</button>
                    </form>
                </div>
            </div>
        </div>
        <!-- M·ªöI: Global Success Unit 4 -->
        <div id="page-globalsuccess-unit4" class="page">
            <div class="subpage-container">
                <button class="btn btn-back" onclick="showPage('globalsuccess', 'globalsuccess')">&larr; Quay l·∫°i Global Success</button>
                <h1>Global Success - Unit 4: Did you go to the party?</h1>
                <div class="lesson-section"><h2>N·ªôi dung Unit 4 ƒëang ƒë∆∞·ª£c c·∫≠p nh·∫≠t...</h2></div>
                <button class="btn btn-complete" onclick="markLessonComplete('globalsuccess-unit4')">Ho√†n th√†nh b√†i h·ªçc</button>
                <div class="lesson-section comment-section">
                    <h2>B√¨nh lu·∫≠n</h2>
                    <div id="comment-list-globalsuccess-unit4" class="comment-list"></div>
                    <form id="comment-form-globalsuccess-unit4" class="comment-form" onsubmit="event.preventDefault(); postComment('globalsuccess-unit4');">
                        <textarea id="comment-input-globalsuccess-unit4" placeholder="Vi·∫øt b√¨nh lu·∫≠n c·ªßa b·∫°n..." required></textarea>
                        <button type="submit" class="btn">G·ª≠i</button>
                    </form>
                </div>
            </div>
        </div>
        <!-- M·ªöI: Global Success Unit 5 -->
        <div id="page-globalsuccess-unit5" class="page">
            <div class="subpage-container">
                <button class="btn btn-back" onclick="showPage('globalsuccess', 'globalsuccess')">&larr; Quay l·∫°i Global Success</button>
                <h1>Global Success - Unit 5: What will you be in the future?</h1>
                <div class="lesson-section"><h2>N·ªôi dung Unit 5 ƒëang ƒë∆∞·ª£c c·∫≠p nh·∫≠t...</h2></div>
                <button class="btn btn-complete" onclick="markLessonComplete('globalsuccess-unit5')">Ho√†n th√†nh b√†i h·ªçc</button>
                <div class="lesson-section comment-section">
                    <h2>B√¨nh lu·∫≠n</h2>
                    <div id="comment-list-globalsuccess-unit5" class="comment-list"></div>
                    <form id="comment-form-globalsuccess-unit5" class="comment-form" onsubmit="event.preventDefault(); postComment('globalsuccess-unit5');">
                        <textarea id="comment-input-globalsuccess-unit5" placeholder="Vi·∫øt b√¨nh lu·∫≠n c·ªßa b·∫°n..." required></textarea>
                        <button type="submit" class="btn">G·ª≠i</button>
                    </form>
                </div>
            </div>
        </div>
        <!-- M·ªöI: Global Success Unit 6 -->
        <div id="page-globalsuccess-unit6" class="page">
            <div class="subpage-container">
                <button class="btn btn-back" onclick="showPage('globalsuccess', 'globalsuccess')">&larr; Quay l·∫°i Global Success</button>
                <h1>Global Success - Unit 6: How many lessons do you have today?</h1>
                <div class="lesson-section"><h2>N·ªôi dung Unit 6 ƒëang ƒë∆∞·ª£c c·∫≠p nh·∫≠t...</h2></div>
                <button class="btn btn-complete" onclick="markLessonComplete('globalsuccess-unit6')">Ho√†n th√†nh b√†i h·ªçc</button>
                <div class="lesson-section comment-section">
                    <h2>B√¨nh lu·∫≠n</h2>
                    <div id="comment-list-globalsuccess-unit6" class="comment-list"></div>
                    <form id="comment-form-globalsuccess-unit6" class="comment-form" onsubmit="event.preventDefault(); postComment('globalsuccess-unit6');">
                        <textarea id="comment-input-globalsuccess-unit6" placeholder="Vi·∫øt b√¨nh lu·∫≠n c·ªßa b·∫°n..." required></textarea>
                        <button type="submit" class="btn">G·ª≠i</button>
                    </form>
                </div>
            </div>
        </div>


    </main>

    <!-- PH·∫¶N 3: FOOTER CHUNG -->
    <footer class="footer">
        <p>¬© 2025 English With Me. All rights reserved. Made by NBP</p>
    </footer>

    <!-- Video Modal Structure -->
    <div id="video-modal" class="modal-overlay" style="display: none;" onclick="closeVideoModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="modal-close" onclick="closeVideoModal()">&times;</span>
            <h3 id="modal-video-title" class="text-xl font-bold mb-4">Video Title</h3>
            <div class="video-player-container">
                <iframe id="modal-video-iframe" width="560" height="315" src="" 
                frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                allowfullscreen></iframe>
            </div>
            <!-- Custom Alert Content -->
            <div id="modal-alert-content" style="display: none; text-align: center; padding: 30px 0;">
                <p id="modal-alert-text" style="font-size: 1.2em;"></p>
                <button class="btn" onclick="closeVideoModal()" style="margin-top: 20px;">ƒê√£ hi·ªÉu</button>
            </div>
        </div>
    </div>

    <!-- PH·∫¶N 4: JAVASCRIPT ƒêI·ªÄU H∆Ø·ªöNG & T√çNH NƒÇNG -->
    <script type="module">
        // --- 0. IMPORT FIREBASE ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, 
            signInAnonymously, 
            signInWithCustomToken, 
            onAuthStateChanged,
            createUserWithEmailAndPassword,
            signInWithEmailAndPassword,
            signOut
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { 
            getFirestore, 
            setLogLevel,
            doc,
            setDoc,
            getDoc,
            collection,
            getDocs,
            addDoc,
            query,
            where,
            onSnapshot,
            increment 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- 0. KHAI B√ÅO BI·∫æN TO√ÄN C·ª§C CHO APP ---
        
        let app, auth, db;
        let currentUser = null;
        
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'my-english-app-github';

        // (B·∫ÆT BU·ªòC) D√°n ƒë·ªëi t∆∞·ª£ng c·∫•u h√¨nh Firebase c·ªßa b·∫°n v√†o ƒë√¢y.
        const firebaseConfig = typeof __firebase_config !== 'undefined' 
            ? JSON.parse(__firebase_config) 
            : {
                 apiKey: "AIzaSyBPAQ8jldVTwtB_uAzz0-oGcZiUaJ3NeyU",
  authDomain: "ewmp-abc18.firebaseapp.com",
  projectId: "ewmp-abc18",
  storageBucket: "ewmp-abc18.firebasestorage.app",
  messagingSenderId: "416084778745",
  appId: "1:416084778745:web:edb8de27952c3007e24c28",
  measurementId: "G-GVP2MCQNLJ"
            };

        const token = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        if (!firebaseConfig.apiKey) {
            console.error("L·ªñI: firebaseConfig ch∆∞a ƒë∆∞·ª£c thi·∫øt l·∫≠p!");
            document.body.innerHTML = `<div style="padding: 40px; text-align: center; font-family: sans-serif; font-size: 1.2em; color: red;">
                <h1>L·ªói C·∫•u H√¨nh</h1>
                <p>Trang web ch∆∞a ƒë∆∞·ª£c c·∫•u h√¨nh Firebase. Vui l√≤ng li√™n h·ªá qu·∫£n tr·ªã vi√™n.</p>
                <p>(N·∫øu b·∫°n l√† qu·∫£n tr·ªã vi√™n, vui l√≤ng d√°n 'firebaseConfig' v√†o t·ªáp HTML.)</p>
            </div>`;
            throw new Error("Firebase config is missing.");
        }
        
        // Bi·∫øn tr·∫°ng th√°i App
        let currentPage = 'home';
        let lessonUnsubscribers = {};
        
        // Bi·∫øn Video Modal & Alert
        let videoModal, modalVideoTitle, modalVideoIframe;
        let modalAlertContent, modalAlertText;
        
        // Bi·∫øn Quiz
        let currentQuiz = {};
        let currentQuestionIndex = 0;
        let score = 0;
        let selectedAnswerIndex = null;
        let quizTitleEl, quizQuestionEl, quizOptionsEl, quizNextBtn, quizContentEl, quizResultEl, quizScoreEl;

        // Bi·∫øn Game Flashcard (C·∫¨P NH·∫¨T: TH√äM T·ª™ V·ª∞NG)
        let flashcardGrid, flipsEl;
        const cardData = [
            { text: 'Apple', id: 'apple' }, { text: 'Qu·∫£ t√°o', id: 'apple' },
            { text: 'Book', id: 'book' }, { text: 'Quy·ªÉn s√°ch', id: 'book' },
            { text: 'Cat', id: 'cat' }, { text: 'Con m√®o', id: 'cat' },
            { text: 'Sun', id: 'sun' }, { text: 'M·∫∑t tr·ªùi', id: 'sun' },
            { text: 'Dog', id: 'dog' }, { text: 'Con ch√≥', id: 'dog' },
            { text: 'House', id: 'house' }, { text: 'Ng√¥i nh√†', id: 'house' },
            { text: 'Blue', id: 'blue' }, { text: 'M√†u xanh', id: 'blue' },
            { text: 'Eat', id: 'eat' }, { text: 'ƒÇn', id: 'eat' }
        ];
        let flippedCards = [];
        let lockBoard = false;
        let flipCount = 0;
        let matchedPairs = 0;
        
        // Bi·∫øn Game Word Connect (C·∫¨P NH·∫¨T: TH√äM LEVEL)
        let wcGridEl, wcFoundWordsEl, wcCurrentWordEl, wcShuffleBtn, wcNextLevelBtn, wcLevelInfoEl, wcFoundListEl;
        let wcCurrentLevel = 0;
        let wcIsDrawing = false;
        let wcCurrentPath = [];
        let wcFoundInLevel = [];
        let wcGridLetters = [];
        const wcGameData = [
            {
                grid: ['C', 'A', 'T', 'O', 'G', 'D', 'N', 'P', 'E'],
                words: ['CAT', 'DOG', 'PEN', 'GET', 'TEN', 'GOT', 'DOT', 'ON', 'AT', 'TO', 'GO', 'DO', 'NO', 'EAT', 'TEA', 'PET', 'APE', 'AGE', 'ONE', 'TOP', 'POT', 'COP', 'COG']
            },
            {
                grid: ['B', 'E', 'D', 'R', 'O', 'M', 'O', 'A', 'K'],
                words: ['BED', 'ROOM', 'BEDROOM', 'BOOK', 'ROBE', 'MORE', 'DOOR', 'DREAM', 'ODE', 'BAD', 'BEAM', 'BROOM', 'BORE', 'MODE']
            },
            {
                grid: ['S', 'L', 'O', 'W', 'C', 'H', 'F', 'O', 'D'],
                words: ['FOOD', 'SLOW', 'COLD', 'HOW', 'LOW', 'OLD', 'FOO', 'DOS', 'FOG', 'SOD', 'WHO']
            }
        ];

        // Bi·∫øn Game Fill Blank (C·∫¨P NH·∫¨T: TH√äM C√ÇU H·ªéI)
        let fbSentenceStartEl, fbSentenceEndEl, fbInputEl, fbCheckBtn, fbFeedbackEl, fbProgressEl, fbGameAreaEl, fbResultsEl, fbRestartBtn, fbResultsScoreEl;
        let fbCurrentQuestion = 0;
        let fbScore = 0;
        const fbGameData = [
            { start: 'She', end: 'breakfast at 7 AM.', answer: 'has' },
            { start: 'My new school is', end: 'a quiet street.', answer: 'on' },
            { start: 'What', end: 'your name?', answer: 'is' },
            { start: 'There', end: 'a book on the table.', answer: 'is' },
            { start: 'There', end: 'two cats under the chair.', answer: 'are' },
            { start: 'Where', end: 'you go yesterday?', answer: 'did' },
            { start: 'I', end: 'football last Sunday.', answer: 'played' },
            { start: 'How', end: 'is this book?', answer: 'much' },
            { start: 'How', end: 'apples are there?', answer: 'many' },
            { start: 'You', end: "play with fire. It's dangerous.", answer: "shouldn't" }
        ];
        
        // Bi·∫øn Element (Auth & Profile)
        let loginLink, registerLink, profileLink, logoutLink;
        let profileEmailEl, profileUserIdEl, profileLogoutBtn;
        let profileQuizResultsEl;
        let profileLessonProgressEl;
        
        let profileUpdateForm, profileDisplayNameInput, profileMessageEl;

        // Bi·∫øn cho t√≠nh nƒÉng AI
        let wordLoadingEl, wordDisplayEl, wordImageEl, wordTermEl, wordDefinitionEl, wordExampleEl, wordErrorEl, newWordBtn;
        const apiKey = ""; // S·∫Ω ƒë∆∞·ª£c cung c·∫•p l√∫c ch·∫°y
        let isFetchingWord = false;
        
        // Bi·∫øn cho B·∫£ng x·∫øp h·∫°ng
        let leaderboardContainerEl, leaderboardLoadingEl;


        // --- 1. H·ªÜ TH·ªêNG CHUY·ªÇN TRANG (Global) ---
        window.showPage = (pageId, activeNavId = null) => {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });

            const targetPage = document.getElementById('page-' + pageId);
            if (targetPage) {
                targetPage.classList.add('active');
                currentPage = pageId;
            }

            document.querySelectorAll('.navbar a').forEach(link => {
                link.classList.remove('active-nav');
                const linkPage = link.getAttribute('data-page');
                if (linkPage === pageId || (activeNavId && linkPage === activeNavId)) {
                    link.classList.add('active-nav');
                }
            });

            Object.values(lessonUnsubscribers).forEach(unsub => unsub());
            lessonUnsubscribers = {};

            if (pageId.startsWith('cambridge-unit') || pageId.startsWith('globalsuccess-unit')) {
                const lessonId = pageId;
                checkLessonCompletion(lessonId);
                loadComments(lessonId);
            }

            if (pageId === 'cambridge' || pageId === 'globalsuccess') {
                loadAllLessonCompletions(pageId);
            }
            
            if (pageId === 'profile') {
                loadProfileData();
            }
            
            if (pageId === 'leaderboard') {
                loadLeaderboard();
            }

            window.scrollTo(0, 0);
        }

        // --- 2. T√çNH NƒÇNG VIDEO MODAL & CUSTOM ALERT (Global) ---
        
        window.showCustomAlert = (message) => {
            modalVideoTitle.textContent = 'Th√¥ng b√°o';
            modalVideoIframe.style.display = 'none';
            modalAlertContent.style.display = 'block';
            modalAlertText.textContent = message;
            videoModal.style.display = 'flex';
        }
        
        window.openVideoModal = (title, youtubeId) => {
            modalVideoTitle.textContent = title;
            modalVideoIframe.style.display = 'block';
            modalAlertContent.style.display = 'none';
            modalVideoIframe.src = `https://www.youtube.com/embed/${youtubeId}?autoplay=1`;
            videoModal.style.display = 'flex';
        }

        window.closeVideoModal = () => {
            modalVideoIframe.src = '';
            videoModal.style.display = 'none';
        }

        // --- 3. T√çNH NƒÇNG AUTH (N·ªôi b·ªô, ƒë∆∞·ª£c g·ªçi b·ªüi Event Listeners) ---
        
        async function handleLogin(event) {
            event.preventDefault();
            const messageEl = document.getElementById('login-message');
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            messageEl.style.display = 'none';

            try {
                await signInWithEmailAndPassword(auth, email, password);
                
                messageEl.textContent = 'ƒêƒÉng nh·∫≠p th√†nh c√¥ng! ƒêang chuy·ªÉn v·ªÅ trang ch·ªß...';
                messageEl.className = 'auth-message success';
                messageEl.style.display = 'block';

                setTimeout(() => {
                    window.showPage('home');
                    messageEl.style.display = 'none';
                    event.target.reset(); 
                }, 1500);

            } catch (error) {
                let errorMsg = 'L·ªói ƒëƒÉng nh·∫≠p. Vui l√≤ng th·ª≠ l·∫°i.';
                if (error.code === 'auth/user-not-found' || error.code === 'auth/invalid-credential') {
                    errorMsg = 'Email ho·∫∑c m·∫≠t kh·∫©u kh√¥ng ch√≠nh x√°c.';
                } else if (error.code === 'auth/invalid-email') {
                    errorMsg = 'Email kh√¥ng h·ª£p l·ªá.';
                }
                
                messageEl.textContent = errorMsg;
                messageEl.className = 'auth-message error';
                messageEl.style.display = 'block';
            }
        }

        async function handleRegister(event) {
            event.preventDefault();
            const messageEl = document.getElementById('register-message');
            const email = document.getElementById('reg-email').value;
            const password = document.getElementById('reg-password').value;
            const confirmPass = document.getElementById('reg-confirm-password').value;

            messageEl.style.display = 'none';

            if (password !== confirmPass) {
                messageEl.textContent = 'M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng kh·ªõp!';
                messageEl.className = 'auth-message error';
                messageEl.style.display = 'block';
                return;
            }
            
            try {
                await createUserWithEmailAndPassword(auth, email, password);
                
                messageEl.textContent = 'ƒêƒÉng k√Ω th√†nh c√¥ng! ƒêang chuy·ªÉn v·ªÅ trang ch·ªß...';
                messageEl.className = 'auth-message success';
                messageEl.style.display = 'block';

                setTimeout(() => {
                    window.showPage('home');
                    messageEl.style.display = 'none';
                    event.target.reset();
                }, 1500);

            } catch (error) {
                let errorMsg = 'L·ªói ƒëƒÉng k√Ω. Vui l√≤ng th·ª≠ l·∫°i.';
                if (error.code === 'auth/email-already-in-use') {
                    errorMsg = 'Email n√†y ƒë√£ ƒë∆∞·ª£c s·ª≠ d·ª•ng.';
                } else if (error.code === 'auth/weak-password') {
                    errorMsg = 'M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±.';
                } else if (error.code === 'auth/invalid-email') {
                    errorMsg = 'Email kh√¥ng h·ª£p l·ªá.';
                }
                
                messageEl.textContent = errorMsg;
                messageEl.className = 'auth-message error';
                messageEl.style.display = 'block';
            }
        }
        
        window.handleLogout = async (event) => {
            if (event) event.preventDefault();
            try {
                await signOut(auth);
                window.showPage('home');
            } catch (error) {
                console.error("L·ªói ƒëƒÉng xu·∫•t: ", error);
            }
        }
        
        async function handleUpdateProfile(event) {
            event.preventDefault();
            if (!currentUser) {
                showCustomAlert("B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p!");
                return;
            }

            const newName = profileDisplayNameInput.value.trim();
            if (newName.length < 3) {
                profileMessageEl.textContent = 'T√™n hi·ªÉn th·ªã ph·∫£i c√≥ √≠t nh·∫•t 3 k√Ω t·ª±.';
                profileMessageEl.className = 'auth-message error';
                profileMessageEl.style.display = 'block';
                return;
            }
            
            profileMessageEl.style.display = 'none';
            const button = event.target.querySelector('button');
            button.disabled = true;

            const docRef = doc(db, "artifacts", appId, "public", "data", "leaderboard", currentUser.uid);

            try {
                await setDoc(docRef, {
                    displayName: newName,
                    userId: currentUser.uid,
                    email: currentUser.email || null, 
                    lastUpdated: new Date()
                }, { merge: true }); 

                profileMessageEl.textContent = 'C·∫≠p nh·∫≠t th√†nh c√¥ng!';
                profileMessageEl.className = 'auth-message success';
                profileMessageEl.style.display = 'block';

            } catch (error) {
                console.error("L·ªói c·∫≠p nh·∫≠t h·ªì s∆°:", error);
                profileMessageEl.textContent = 'L·ªói khi c·∫≠p nh·∫≠t. Vui l√≤ng th·ª≠ l·∫°i.';
                profileMessageEl.className = 'auth-message error';
                profileMessageEl.style.display = 'block';
            } finally {
                button.disabled = false;
            }
        }

        // --- 4. T√çNH NƒÇNG QUIZ (Global) (C·∫¨P NH·∫¨T: TH√äM QUIZ) ---
        
        const quizzes = {
            'unit1': {
                title: 'ƒê·ªÅ ki·ªÉm tra 15 ph√∫t - Unit 1',
                questions: [
                    { q: 'We ___ new students.', options: ['are', 'is', 'am', 'be'], answer: 0 },
                    { q: 'She ___ breakfast at 7 AM.', options: ['have', 'has', 'is', 'are'], answer: 1 },
                    { q: 'My new school is ___ a quiet street.', options: ['in', 'at', 'on', 'with'], answer: 2 },
                    { q: 'What ___ your address?', options: ['is', 'are', 'am', 'be'], answer: 0 },
                    { q: '___ they like Maths?', options: ['Do', 'Does', 'Are', 'Is'], answer: 0 },
                    { q: 'He ___ his homework every day.', options: ['do', 'does', 'is doing', 'doing'], answer: 1 },
                    { q: 'Look! The girls ___ rope.', options: ['is skipping', 'are skipping', 'skip', 'skips'], answer: 1 },
                    { q: 'There ___ a library in my school.', options: ['is', 'are', 'am', 'be'], answer: 0 },
                    { q: 'There ___ many trees in the park.', options: ['is', 'are', 'am', 'be'], answer: 1 },
                    { q: 'I have Music ___ Monday.', options: ['in', 'at', 'on', 'with'], answer: 2 }
                ]
            },
            'midterm1': {
                title: 'ƒê·ªÅ thi gi·ªØa k·ª≥ 1',
                questions: [
                    { q: 'What ___ your name?', options: ['are', 'is', 'am', 'be'], answer: 1 },
                    { q: 'How old ___ you?', options: ['is', 'are', 'am', 'be'], answer: 1 },
                    { q: 'He lives ___ 123 Tran Hung Dao Street.', options: ['in', 'at', 'on', 'with'], answer: 1 },
                    { q: 'My birthday is ___ September.', options: ['in', 'at', 'on', 'with'], answer: 0 },
                    { q: 'What time ___ you get up?', options: ['does', 'is', 'do', 'are'], answer: 2 },
                    { q: 'He often ___ football in the afternoon.', options: ['play', 'plays', 'is playing', 'are playing'], answer: 1 },
                    { q: 'Where ___ your parents from?', options: ['is', 'are', 'do', 'does'], answer: 1 },
                    { q: '___ is your school?', 'options': ['What', 'Where', 'When', 'Who'], answer: 1 },
                    { q: 'It is ___ first floor.', options: ['in', 'at', 'on', 'with'], answer: 2 },
                    { q: 'I ___ to school by bus every day.', options: ['go', 'goes', 'am going', 'is going'], answer: 0 },
                    { q: 'What is your ___ subject?', options: ['favourite', 'like', 'good', 'nice'], answer: 0 },
                    { q: 'How ___ lessons do you have today?', options: ['much', 'many', 'old', 'what'], answer: 1 },
                    { q: 'She is ___ than her sister.', options: ['tall', 'taller', 'the tallest', 'more tall'], answer: 1 },
                    { q: 'A supermarket is ___ than a shop.', options: ['big', 'bigger', 'the biggest', 'more big'], answer: 1 },
                    { q: 'This is the ___ building in the city.', options: ['high', 'higher', 'highest', 'more high'], answer: 2 }
                ]
            },
            'vocab1-2': {
                title: 'ƒê·ªÅ ki·ªÉm tra t·ª´ v·ª±ng - Unit 1 & 2',
                questions: [
                    { q: 'T·ª´ n√†o c√≥ nghƒ©a l√† "th∆∞ vi·ªán"?', options: ['Classroom', 'Library', 'Gym', 'Garden'], answer: 1 },
                    { q: 'T·ª´ n√†o c√≥ nghƒ©a l√† "b√∫t ch√¨"?', options: ['Pen', 'Book', 'Pencil', 'Ruler'], answer: 2 },
                    { q: 'T·ª´ n√†o c√≥ nghƒ©a l√† "s√¢n ch∆°i"?', options: ['Playground', 'Bedroom', 'Kitchen', 'Bathroom'], answer: 0 },
                    { q: 'T·ª´ n√†o c√≥ nghƒ©a l√† "gia ƒë√¨nh"?', options: ['Friends', 'Teacher', 'Family', 'Student'], answer: 2 },
                    { q: 'T·ª´ n√†o c√≥ nghƒ©a l√† "ƒë·ªãa ch·ªâ"?', options: ['Name', 'Age', 'Address', 'Street'], answer: 2 },
                    { q: 'T·ª´ n√†o c√≥ nghƒ©a l√† "bu·ªïi s√°ng"?', options: ['Morning', 'Afternoon', 'Evening', 'Night'], answer: 0 },
                    { q: 'T·ª´ n√†o c√≥ nghƒ©a l√† "lu√¥n lu√¥n"?', options: ['Sometimes', 'Usually', 'Never', 'Always'], answer: 3 },
                    { q: 'T·ª´ n√†o c√≥ nghƒ©a l√† "th√†nh ph·ªë"?', options: ['Village', 'Town', 'City', 'Country'], answer: 2 },
                    { q: 'T·ª´ n√†o c√≥ nghƒ©a l√† "m√¥n h·ªçc"?', options: ['Subject', 'Class', 'School', 'Teacher'], answer: 0 },
                    { q: 'T·ª´ n√†o c√≥ nghƒ©a l√† "b·∫°n b√®"?', options: ['Family', 'Parents', 'Friends', 'Brother'], answer: 2 }
                ]
            },
            // M·ªöI: QUIZ UNIT 3
            'unit3': {
                title: 'ƒê·ªÅ ki·ªÉm tra 15 ph√∫t - Unit 3 (Holiday)',
                questions: [
                    { q: 'Where ___ you go last summer?', options: ['do', 'does', 'did', 'are'], answer: 2 },
                    { q: 'I ___ to Ha Long Bay.', options: ['go', 'goes', 'went', 'am going'], answer: 2 },
                    { q: 'What was the trip like? - It ___ great.', options: ['is', 'are', 'was', 'were'], answer: 2 },
                    { q: '___ they enjoy the food?', options: ['Do', 'Does', 'Did', 'Were'], answer: 2 },
                    { q: 'We ___ in a nice hotel.', options: ['stay', 'stays', 'stayed', 'staying'], answer: 2 },
                    { q: 'She ___ buy any souvenirs.', options: ["don't", "doesn't", "didn't", "wasn't"], answer: 2 },
                    { q: 'I ___ photos of the island.', options: ['take', 'took', 'takes', 'taking'], answer: 1 },
                    { q: '___ was your holiday?', options: ['What', 'Where', 'How', 'When'], answer: 2 },
                    { q: 'We ___ back home yesterday.', options: ['come', 'comes', 'came', 'coming'], answer: 2 },
                    { q: 'My parents ___ very happy.', options: ['is', 'are', 'was', 'were'], answer: 3 }
                ]
            },
            // M·ªöI: QUIZ UNIT 4
            'unit4': {
                title: 'ƒê·ªÅ ki·ªÉm tra 15 ph√∫t - Unit 4 (Food)',
                questions: [
                    { q: 'How ___ rice do you want?', options: ['many', 'much', 'a', 'an'], answer: 1 },
                    { q: 'How ___ eggs do you need?', options: ['many', 'much', 'a', 'an'], answer: 0 },
                    { q: 'I want a ___ of chocolate.', options: ['can', 'bar', 'bottle', 'box'], answer: 1 },
                    { q: 'She would like a ___ of milk.', options: ['packet', 'kilo', 'glass', 'can'], answer: 2 },
                    { q: 'What would you like ___ breakfast?', options: ['in', 'at', 'on', 'for'], answer: 3 },
                    { q: 'I am hungry. I want ___ noodles.', options: ['a', 'an', 'some', 'any'], answer: 2 },
                    { q: 'Is there ___ milk in the fridge?', options: ['a', 'an', 'some', 'any'], answer: 3 },
                    { q: 'There isn\'t ___ water left.', options: ['a', 'an', 'some', 'any'], answer: 3 },
                    { q: 'I\'d like ___ apple, please.', options: ['a', 'an', 'some', 'any'], answer: 1 },
                    { q: 'How much is a ___ of bread?', options: ['loaf', 'dozen', 'kilo', 'bar'], answer: 0 }
                ]
            },
            'finalterm1': {
                title: 'ƒê·ªÅ thi cu·ªëi k·ª≥ 1',
                questions: [
                    { q: 'Odd one out: (T√¨m t·ª´ kh√°c lo·∫°i)', options: ['Father', 'Mother', 'Teacher', 'Sister'], answer: 2 },
                    { q: 'Odd one out: (T√¨m t·ª´ kh√°c lo·∫°i)', options: ['In', 'At', 'On', 'And'], answer: 3 },
                    { q: 'Odd one out: (T√¨m t·ª´ kh√°c lo·∫°i)', options: ['Book', 'Pen', 'Ruler', 'Play'], answer: 3 },
                    { q: 'What did you do yesterday? - I ___ football.', options: ['play', 'played', 'am playing', 'plays'], answer: 1 },
                    { q: 'Where did she go? - She ___ to the zoo.', options: ['go', 'goes', 'went', 'is going'], answer: 2 },
                    { q: 'Did you ___ TV last night?', options: ['watch', 'watched', 'watching', 'watches'], answer: 0 },
                    { q: 'He ___ born in 2015.', options: ['is', 'are', 'was', 'were'], answer: 2 },
                    { q: 'They ___ at the beach last weekend.', options: ['is', 'are', 'was', 'were'], answer: 3 },
                    { q: '___ you at home yesterday?', options: ['Is', 'Are', 'Was', 'Were'], answer: 3 },
                    { q: 'What is ___ address? - It\'s 10 Le Loi Street.', options: ['you', 'your', 'my', 'his'], answer: 1 },
                    { q: 'What do you do ___ the morning?', options: ['in', 'at', 'on', 'with'], answer: 0 },
                    { q: 'I always ___ my teeth before breakfast.', options: ['brush', 'wash', 'do', 'have'], answer: 0 },
                    { q: 'Hanoi is the ___ of Vietnam.', options: ['city', 'country', 'capital', 'village'], answer: 2 },
                    { q: 'Ho Chi Minh city is ___ than Da Nang.', options: ['biger', 'more big', 'bigger', 'the biggest'], answer: 2 },
                    { q: 'What is the ___ city in Vietnam?', options: ['big', 'bigger', 'biggest', 'more big'], answer: 2 },
                    { q: 'Look! The baby ___.', options: ['sleep', 'sleeps', 'is sleeping', 'are sleeping'], answer: 2 },
                    { q: 'My classroom is ___ the second floor.', options: ['in', 'at', 'on', 'with'], answer: 2 },
                    { q: 'How ___ is a bowl of noodles? - It\'s 30,000 dong.', options: ['many', 'much', 'old', 'what'], answer: 1 },
                    { q: 'How ___ apples do you want?', options: ['many', 'much', 'old', 'what'], answer: 0 },
                    { q: 'What would you like to drink? - I\'d like ___ water.', options: ['a', 'an', 'some', 'any'], answer: 2 }
                ]
            },
            'midterm2': {
                title: 'ƒê·ªÅ thi gi·ªØa k·ª≥ 2',
                questions: [
                    { q: 'Where ___ you go on holiday?', options: ['did', 'do', 'does', 'are'], answer: 0 },
                    { q: 'I went ___ Ha Long Bay.', options: ['in', 'at', 'on', 'to'], answer: 3 },
                    { q: 'What was the trip like? - It was ___', options: ['fun', 'funny', 'funnier', 'funniest'], answer: 0 },
                    { q: '___ you join the funfair yesterday?', options: ['Do', 'Did', 'Were', 'Was'], answer: 1 },
                    { q: 'No, I ___', options: ['don\'t', 'do', 'didn\'t', 'did'], answer: 2 },
                    { q: 'What will you do this weekend? - I ___ visit my grandparents.', options: ['am', 'will', 'do', 'did'], answer: 1 },
                    { q: '___ you like to go for a picnic?', options: ['Do', 'Are', 'Would', 'Will'], answer: 2 },
                    { q: 'Yes, I\'d love ___', options: ['to', 'too', 'two', 'for'], answer: 0 },
                    { q: 'Can you ___ the piano?', options: ['play', 'do', 'go', 'have'], answer: 0 },
                    { q: 'She ___ speak English very well.', options: ['is', 'can', 'do', 'has'], answer: 1 },
                    { q: 'You ___ play with matches. It\'s dangerous.', options: ['should', 'shouldn\'t', 'can', 'can\'t'], answer: 1 },
                    { q: 'You ___ do your homework before going to school.', options: ['should', 'shouldn\'t', 'mustn\'t', 'can\'t'], answer: 0 },
                    { q: 'Why ___ I go to the doctor?', options: ['should', 'do', 'can', 'must'], answer: 0 },
                    { q: 'Because you have a ___', options: ['fever', 'head', 'arm', 'leg'], answer: 0 },
                    { q: 'What\'s the matter ___ you?', options: ['on', 'with', 'in', 'at'], answer: 1 }
                ]
            }
        };

        window.startQuiz = (quizId) => {
            if (!quizzes[quizId]) return;
            
            currentQuiz = quizzes[quizId];
            currentQuiz.id = quizId; 
            currentQuestionIndex = 0;
            score = 0;
            selectedAnswerIndex = null;
            
            quizContentEl.style.display = 'block';
            quizResultEl.style.display = 'none';
            quizNextBtn.textContent = 'C√¢u ti·∫øp theo';
            
            window.showPage('quiz', 'tests');
            
            quizTitleEl.textContent = currentQuiz.title;
            renderQuestion();
        }

        function renderQuestion() {
            selectedAnswerIndex = null;
            const question = currentQuiz.questions[currentQuestionIndex];
            quizQuestionEl.textContent = question.q;
            quizOptionsEl.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionEl = document.createElement('div');
                optionEl.textContent = option;
                optionEl.classList.add('quiz-option');
                optionEl.onclick = () => selectAnswer(optionEl, index);
                quizOptionsEl.appendChild(optionEl);
            });
            
            quizNextBtn.disabled = true;
        }

        function selectAnswer(optionEl, index) {
            document.querySelectorAll('.quiz-option').forEach(el => el.classList.remove('selected'));
            optionEl.classList.add('selected');
            selectedAnswerIndex = index;
            quizNextBtn.disabled = false;
        }

        window.nextQuestion = () => {
            const question = currentQuiz.questions[currentQuestionIndex];
            const correct = (selectedAnswerIndex === question.answer);
            if (correct) {
                score++;
            }
            
            currentQuestionIndex++;
            if (currentQuestionIndex < currentQuiz.questions.length) {
                renderQuestion();
                if (currentQuestionIndex === currentQuiz.questions.length - 1) {
                    quizNextBtn.textContent = 'Ho√†n th√†nh';
                }
            } else {
                showResults();
            }
        }

        function showResults() {
            quizContentEl.style.display = 'none';
            quizResultEl.style.display = 'block';
            const resultText = `B·∫°n ƒë√£ tr·∫£ l·ªùi ƒë√∫ng ${score} / ${currentQuiz.questions.length} c√¢u!`;
            quizScoreEl.textContent = resultText;
            
            saveQuizResult(currentQuiz.id, score, currentQuiz.questions.length, currentQuiz.title);
            
            if (score > 0) {
                updateUserScore(score); 
            }
        }

        async function saveQuizResult(quizId, score, total, title) {
            if (!currentUser) {
                console.log("Kh√¥ng th·ªÉ l∆∞u k·∫øt qu·∫£ (ng∆∞·ªùi d√πng ch∆∞a ƒëƒÉng nh·∫≠p).");
                return;
            }
            
            try {
                const docRef = doc(db, "artifacts", appId, "users", currentUser.uid, "quizResults", quizId);
                const data = {
                    quizId: quizId,
                    title: title,
                    score: score,
                    total: total,
                    timestamp: new Date()
                };
                await setDoc(docRef, data); 
                console.log("ƒê√£ l∆∞u k·∫øt qu·∫£ quiz (private):", quizId);
            } catch (error) {
                console.error("L·ªói khi l∆∞u k·∫øt qu·∫£ quiz (private):", error);
            }
        }

        async function loadProfileData() {
            if (currentUser) {
                profileEmailEl.textContent = currentUser.email || 'Kh√¥ng c√≥ (T√†i kho·∫£n ·∫©n danh)';
                profileUserIdEl.textContent = currentUser.uid;
                
                profileDisplayNameInput.value = ''; 
                profileMessageEl.style.display = 'none'; 
                
                try {
                    const docRef = doc(db, "artifacts", appId, "public", "data", "leaderboard", currentUser.uid);
                    const docSnap = await getDoc(docRef);
                    if (docSnap.exists() && docSnap.data().displayName) {
                        profileDisplayNameInput.value = docSnap.data().displayName;
                    } else if (currentUser.email) {
                        profileDisplayNameInput.value = currentUser.email.split('@')[0];
                    }
                } catch (error) {
                    console.error("L·ªói khi t·∫£i t√™n hi·ªÉn th·ªã:", error);
                }
                
            }

            profileQuizResultsEl.innerHTML = '<p>ƒêang t·∫£i k·∫øt qu·∫£...</p>';

            if (!currentUser) {
                profileQuizResultsEl.innerHTML = '<p>Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ xem ti·∫øn ƒë·ªô.</p>';
                profileLessonProgressEl.innerHTML = '<p>Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ xem ti·∫øn ƒë·ªô.</p>';
                return;
            }

            try {
                const collRef = collection(db, "artifacts", appId, "users", currentUser.uid, "quizResults");
                const querySnapshot = await getDocs(collRef);

                if (querySnapshot.empty) {
                    profileQuizResultsEl.innerHTML = '<p>Ch∆∞a c√≥ k·∫øt qu·∫£ n√†o ƒë∆∞·ª£c l∆∞u.</p>';
                } else {
                    let html = '<ul style="list-style-type: none; padding-left: 0;">';
                    querySnapshot.forEach((doc) => {
                        const data = doc.data();
                        const timestamp = data.timestamp?.seconds ? new Date(data.timestamp.seconds * 1000) : new Date();
                        
                        html += `<li style="padding: 10px; border-bottom: 1px solid #eee;">
                            <strong>${data.title || data.quizId}</strong>: ${data.score} / ${data.total}
                            <br>
                            <small style="color: #777;">L√†m ng√†y: ${timestamp.toLocaleString('vi-VN')}</small>
                        </li>`;
                    });
                    html += '</ul>';
                    profileQuizResultsEl.innerHTML = html;
                }
            } catch (error) {
                console.error("L·ªói khi t·∫£i k·∫øt qu·∫£ quiz:", error);
                profileQuizResultsEl.innerHTML = '<p style="color: red;">L·ªói khi t·∫£i k·∫øt qu·∫£ quiz.</p>';
            }
            
            await loadProfileLessonProgress();
        }
        
        async function loadProfileLessonProgress() {
            const el = profileLessonProgressEl;
            el.innerHTML = '<p>ƒêang t·∫£i ti·∫øn ƒë·ªô...</p>';
            if (!currentUser) {
                el.innerHTML = '<p>Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ xem ti·∫øn ƒë·ªô.</p>';
                return;
            }

            const collRef = collection(db, "artifacts", appId, "users", currentUser.uid, "lessonProgress");
            const q = query(collRef, where("completed", "==", true));
            
            try {
                const querySnapshot = await getDocs(q);
                if (querySnapshot.empty) {
                    el.innerHTML = '<p>Ch∆∞a ho√†n th√†nh b√†i h·ªçc n√†o.</p>';
                    return;
                }

                let html = '<ul style="list-style-type: none; padding-left: 0;">';
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    const lessonId = doc.id;
                    const timestamp = data.timestamp?.seconds ? new Date(data.timestamp.seconds * 1000) : new Date();
                    html += `<li style="padding: 10px; border-bottom: 1px solid #eee;">
                        <strong>${lessonId}</strong>
                        <br>
                        <small style="color: #777;">Ho√†n th√†nh: ${timestamp.toLocaleString('vi-VN')}</small>
                    </li>`;
                });
                html += '</ul>';
                el.innerHTML = html;
            } catch (error) {
                console.error("L·ªói khi t·∫£i ti·∫øn ƒë·ªô h·ªì s∆°: ", error);
                el.innerHTML = '<p style="color: red;">L·ªói khi t·∫£i ti·∫øn ƒë·ªô b√†i h·ªçc.</p>';
            }
        }
        
        // --- 5. T√çNH NƒÇNG GAME (Chung) ---
        
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        window.startGame = (gameId) => {
            if (gameId === 'flashcard') {
                window.showPage('game-flashcard', 'games');
                initFlashcardGame();
            }
            if (gameId === 'wordconnect') {
                window.showPage('game-wordconnect', 'games');
                initWordConnectGame();
            }
            if (gameId === 'fillblank') {
                window.showPage('game-fillblank', 'games');
                initFillBlankGame();
            }
        }

        // --- 5.1 T√çNH NƒÇNG GAME FLASHCARD (Global) ---
        
        window.initFlashcardGame = () => {
            flashcardGrid.innerHTML = '';
            flippedCards = [];
            lockBoard = false;
            flipCount = 0;
            matchedPairs = 0;
            flipsEl.textContent = '0';
            
            let gameCards = [...cardData];
            shuffleArray(gameCards);
            
            gameCards.forEach(item => {
                const cardElement = document.createElement('div');
                cardElement.classList.add('flashcard');
                cardElement.dataset.id = item.id;
                
                cardElement.innerHTML = `
                    <div class="flashcard-inner">
                        <div class="flashcard-front">?</div>
                        <div class="flashcard-back">${item.text}</div>
                    </div>
                `;
                
                cardElement.addEventListener('click', () => flipCard(cardElement));
                flashcardGrid.appendChild(cardElement);
            });
        }

        function flipCard(cardElement) {
            if (lockBoard || cardElement.classList.contains('flipped') || flippedCards.length === 2) return;

            cardElement.classList.add('flipped');
            flippedCards.push(cardElement);
            
            flipCount++;
            flipsEl.textContent = flipCount;

            if (flippedCards.length === 2) {
                lockBoard = true;
                checkForMatch();
            }
        }

        function checkForMatch() {
            const [card1, card2] = flippedCards;
            const isMatch = card1.dataset.id === card2.dataset.id;
            isMatch ? disableCards() : unflipCards();
        }

        function disableCards() {
            flippedCards[0].classList.add('matched');
            flippedCards[1].classList.add('matched');
            matchedPairs++;
            if (matchedPairs === cardData.length / 2) {
                setTimeout(() => {
                    showCustomAlert(`Ho√†n th√†nh sau ${flipCount} l·∫ßn l·∫≠t!`);
                }, 500);
            }
            resetBoard();
        }

        function unflipCards() {
            setTimeout(() => {
                flippedCards[0].classList.remove('flipped');
                flippedCards[1].classList.remove('flipped');
                resetBoard();
            }, 1500);
        }
        
        function resetBoard() {
            [flippedCards, lockBoard] = [[], false];
        }
        
        // --- 5.2 T√çNH NƒÇNG GAME WORD CONNECT ---
        
        function initWordConnectGame(level = 0) {
            wcCurrentLevel = level;
            wcCurrentPath = [];
            wcFoundInLevel = [];
            wcIsDrawing = false;
            wcNextLevelBtn.style.display = 'none';
            wcLevelInfoEl.textContent = `Level ${wcCurrentLevel + 1}`;
            
            if (level >= wcGameData.length) {
                wcLevelInfoEl.textContent = "B·∫°n ƒë√£ ho√†n th√†nh t·∫•t c·∫£!";
                wcGridEl.innerHTML = "<p>Ch√∫c m·ª´ng!</p>";
                wcFoundListEl.innerHTML = "";
                wcCurrentWordEl.textContent = "";
                return;
            }
            
            loadWordConnectLevel(wcCurrentLevel);
        }
        
        function loadWordConnectLevel(levelIndex) {
            const level = wcGameData[levelIndex];
            wcGridEl.innerHTML = '';
            wcFoundListEl.innerHTML = '';
            wcCurrentWordEl.textContent = '';
            wcFoundInLevel = [];
            
            const gridSize = Math.sqrt(level.grid.length);
            wcGridEl.style.gridTemplateColumns = `repeat(${gridSize}, 80px)`;
            
            wcGridLetters = [...level.grid];
            
            wcGridLetters.forEach((letter, index) => {
                const letterEl = document.createElement('div');
                letterEl.classList.add('wc-letter');
                letterEl.textContent = letter;
                letterEl.dataset.index = index;
                letterEl.dataset.letter = letter;
                wcGridEl.appendChild(letterEl);
            });
        }
        
        function handleWCGridMouseStart(e) {
            e.preventDefault();
            if (e.target.classList.contains('wc-letter')) {
                wcIsDrawing = true;
                const el = e.target;
                wcCurrentPath = [{
                    el: el,
                    letter: el.dataset.letter,
                    index: parseInt(el.dataset.index)
                }];
                el.classList.add('selected');
                updateWCCurrentWord();
            }
        }

        function handleWCGridMouseMove(e) {
            e.preventDefault();
            if (!wcIsDrawing) return;
            
            const el = document.elementFromPoint(
                e.clientX || e.touches[0].clientX, 
                e.clientY || e.touches[0].clientY
            );
            
            if (el && el.classList.contains('wc-letter') && !el.classList.contains('selected')) {
                wcCurrentPath.push({
                    el: el,
                    letter: el.dataset.letter,
                    index: parseInt(el.dataset.index)
                });
                el.classList.add('selected');
                updateWCCurrentWord();
            }
        }
        
        function handleWCGridMouseEnd(e) {
            e.preventDefault();
            if (!wcIsDrawing) return;
            wcIsDrawing = false;
            checkWCWord();
            resetWCPath();
        }

        function updateWCCurrentWord() {
            wcCurrentWordEl.textContent = wcCurrentPath.map(item => item.letter).join('');
        }
        
        function resetWCPath() {
            wcCurrentPath.forEach(item => item.el.classList.remove('selected'));
            wcCurrentPath = [];
            setTimeout(() => {
                wcCurrentWordEl.textContent = '';
            }, 200);
        }
        
        function checkWCWord() {
            const word = wcCurrentWordEl.textContent;
            const levelWords = wcGameData[wcCurrentLevel].words;
            
            if (word.length < 2) return;
            
            if (levelWords.includes(word) && !wcFoundInLevel.includes(word)) {
                wcFoundInLevel.push(word);
                const li = document.createElement('li');
                li.textContent = word;
                wcFoundListEl.appendChild(li);
                
                if (wcFoundInLevel.length === levelWords.length) {
                    showCustomAlert("Ch√∫c m·ª´ng! B·∫°n ƒë√£ ho√†n th√†nh level!");
                    wcNextLevelBtn.style.display = 'block';
                }
            }
        }
        
        function shuffleWCGrid() {
            shuffleArray(wcGridLetters);
            const letters = wcGridEl.querySelectorAll('.wc-letter');
            letters.forEach((el, index) => {
                const newLetter = wcGridLetters[index];
                el.textContent = newLetter;
                el.dataset.letter = newLetter;
            });
        }
        
        // --- 5.3 T√çNH NƒÇNG GAME FILL BLANK ---
        
        function initFillBlankGame() {
            fbCurrentQuestion = 0;
            fbScore = 0;
            fbGameAreaEl.style.display = 'block';
            fbResultsEl.style.display = 'none';
            fbCheckBtn.textContent = 'Ki·ªÉm tra';
            fbCheckBtn.onclick = checkFillBlankAnswer;
            loadFillBlankQuestion(fbCurrentQuestion);
        }
        
        function loadFillBlankQuestion(index) {
            if (index >= fbGameData.length) {
                showFillBlankResults();
                return;
            }
            
            const q = fbGameData[index];
            fbProgressEl.textContent = `C√¢u ${index + 1} / ${fbGameData.length}`;
            fbSentenceStartEl.textContent = q.start;
            fbSentenceEndEl.textContent = q.end;
            fbInputEl.value = '';
            fbFeedbackEl.textContent = '';
            fbFeedbackEl.className = 'fb-feedback';
            fbInputEl.disabled = false;
            fbCheckBtn.disabled = false;
        }
        
        function checkFillBlankAnswer() {
            const userAnswer = fbInputEl.value.trim().toLowerCase();
            const correctAnswer = fbGameData[fbCurrentQuestion].answer.toLowerCase();
            
            if (userAnswer === correctAnswer) {
                fbFeedbackEl.textContent = 'Ch√≠nh x√°c!';
                fbFeedbackEl.className = 'fb-feedback correct';
                fbScore++;
            } else {
                fbFeedbackEl.textContent = `Sai r·ªìi! ƒê√°p √°n ƒë√∫ng l√†: ${fbGameData[fbCurrentQuestion].answer}`;
                fbFeedbackEl.className = 'fb-feedback wrong';
            }
            
            fbInputEl.disabled = true;
            fbCheckBtn.disabled = true;
            
            setTimeout(() => {
                fbCurrentQuestion++;
                loadFillBlankQuestion(fbCurrentQuestion);
            }, 2000);
        }
        
        function showFillBlankResults() {
            fbGameAreaEl.style.display = 'none';
            fbResultsEl.style.display = 'block';
            fbResultsScoreEl.textContent = `B·∫°n ƒë√∫ng ${fbScore} / ${fbGameData.length} c√¢u.`;
            
            if (fbScore > 0) {
                updateUserScore(fbScore);
            }
        }

        // --- 6. T√çNH NƒÇNG TI·∫æN ƒê·ªò B√ÄI H·ªåC ---
        
        window.markLessonComplete = async (lessonId) => {
            if (!currentUser) {
                showCustomAlert("B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p ƒë·ªÉ l∆∞u ti·∫øn ƒë·ªô!");
                return;
            }
            
            const buttonEl = document.querySelector(`#page-${lessonId} .btn-complete`);
            if (buttonEl.classList.contains('completed')) return;

            const docRef = doc(db, "artifacts", appId, "users", currentUser.uid, "lessonProgress", lessonId);
            
            try {
                await setDoc(docRef, {
                    completed: true,
                    timestamp: new Date(),
                    lessonId: lessonId
                });
                buttonEl.textContent = 'ƒê√£ ho√†n th√†nh';
                buttonEl.classList.add('completed');
                buttonEl.disabled = true;
                
                const iconEl = document.getElementById(`icon-${lessonId}`);
                if (iconEl) {
                    iconEl.textContent = '‚úì';
                }
            } catch (error) {
                console.error("L·ªói khi l∆∞u ti·∫øn ƒë·ªô: ", error);
                showCustomAlert("ƒê√£ x·∫£y ra l·ªói khi l∆∞u ti·∫øn ƒë·ªô.");
            }
        }
        
        async function checkLessonCompletion(lessonId) {
            const buttonEl = document.querySelector(`#page-${lessonId} .btn-complete`);
            if (!buttonEl) return;
            
            buttonEl.textContent = 'Ho√†n th√†nh b√†i h·ªçc';
            buttonEl.classList.remove('completed');
            buttonEl.disabled = false;

            if (!currentUser) return;
            
            const docRef = doc(db, "artifacts", appId, "users", currentUser.uid, "lessonProgress", lessonId);
            
            try {
                const docSnap = await getDoc(docRef);
                if (docSnap.exists() && docSnap.data().completed) {
                    buttonEl.textContent = 'ƒê√£ ho√†n th√†nh';
                    buttonEl.classList.add('completed');
                    buttonEl.disabled = true;
                }
            } catch (error) {
                console.error("L·ªói khi ki·ªÉm tra ti·∫øn ƒë·ªô: ", error);
            }
        }
        
        async function loadAllLessonCompletions(courseType) {
            document.querySelectorAll(`#page-${courseType} .completion-icon`).forEach(icon => {
                icon.textContent = '';
            });

            if (!currentUser) return;

            const collRef = collection(db, "artifacts", appId, "users", currentUser.uid, "lessonProgress");
            const q = query(collRef, where("completed", "==", true));
            
            try {
                const querySnapshot = await getDocs(q);
                querySnapshot.forEach((doc) => {
                    const lessonId = doc.id;
                    const iconEl = document.getElementById(`icon-${lessonId}`);
                    if (iconEl) {
                        iconEl.textContent = '‚úì';
                    }
                });
            } catch (error) {
                console.error("L·ªói khi t·∫£i to√†n b·ªô ti·∫øn ƒë·ªô: ", error);
            }
        }

        // --- 7. T√çNH NƒÇNG B√åNH LU·∫¨N ---

        async function loadComments(lessonId) {
            const commentListEl = document.getElementById(`comment-list-${lessonId}`);
            if (!commentListEl) return;

            commentListEl.innerHTML = "<p>ƒêang t·∫£i b√¨nh lu·∫≠n...</p>";
            
            const collRef = collection(db, "artifacts", appId, "public", "data", "lessonComments");
            const q = query(collRef, where("lessonId", "==", lessonId));
            
            const unsubscribe = onSnapshot(q, (querySnapshot) => {
                if (querySnapshot.empty) {
                    commentListEl.innerHTML = "<p>Ch∆∞a c√≥ b√¨nh lu·∫≠n n√†o. H√£y l√† ng∆∞·ªùi ƒë·∫ßu ti√™n!</p>";
                    return;
                }
                
                let comments = [];
                querySnapshot.forEach((doc) => {
                    comments.push(doc.data());
                });
                
                comments.sort((a, b) => (a.timestamp?.seconds || 0) - (b.timestamp?.seconds || 0));

                commentListEl.innerHTML = '';
                comments.forEach(comment => {
                    renderComment(lessonId, comment);
                });
                
                commentListEl.scrollTop = commentListEl.scrollHeight;

            }, (error) => {
                console.error("L·ªói khi t·∫£i b√¨nh lu·∫≠n: ", error);
                commentListEl.innerHTML = "<p style='color:red;'>Kh√¥ng th·ªÉ t·∫£i b√¨nh lu·∫≠n.</p>";
            });

            lessonUnsubscribers[lessonId] = unsubscribe;
        }

        function renderComment(lessonId, data) {
            const commentListEl = document.getElementById(`comment-list-${lessonId}`);
            if (!commentListEl) return;
            
            const item = document.createElement('div');
            item.className = 'comment-item';
            
            const timestamp = data.timestamp?.seconds ? new Date(data.timestamp.seconds * 1000) : new Date();
            
            const name = data.displayName 
                       || (data.email ? data.email.split('@')[0] : 
                          (data.userId ? `User-${data.userId.substring(0, 6)}` : 'Anonymous'));
            
            const safeText = data.text.replace(/</g, "&lt;").replace(/>/g, "&gt;");
            
            item.innerHTML = `
                <strong>${name}</strong>
                <p>${safeText}</p>
                <small>${timestamp.toLocaleString('vi-VN')}</small>
            `;
            commentListEl.appendChild(item);
        }

        window.postComment = async (lessonId) => {
            const inputEl = document.getElementById(`comment-input-${lessonId}`);
            const formEl = document.getElementById(`comment-form-${lessonId}`);
            const text = inputEl.value.trim();
            
            const oldMsg = formEl.querySelector('.auth-message');
            if (oldMsg) oldMsg.style.display = 'none';

            if (!text) return;
            
            if (!currentUser || currentUser.isAnonymous) {
                let msgEl = formEl.querySelector('.auth-message');
                if (!msgEl) {
                    msgEl = document.createElement('div');
                    msgEl.className = 'auth-message error';
                    formEl.prepend(msgEl);
                }
                msgEl.textContent = 'B·∫°n c·∫ßn ƒêƒÉng nh·∫≠p / ƒêƒÉng k√Ω ƒë·ªÉ b√¨nh lu·∫≠n!';
                msgEl.style.display = 'block';
                return;
            }
            
            let displayName = currentUser.email ? currentUser.email.split('@')[0] : `User-${currentUser.uid.substring(0, 6)}`; 
            try {
                const profileDocRef = doc(db, "artifacts", appId, "public", "data", "leaderboard", currentUser.uid);
                const profileSnap = await getDoc(profileDocRef);
                if (profileSnap.exists() && profileSnap.data().displayName) {
                    displayName = profileSnap.data().displayName;
                }
            } catch (e) {
                console.warn("Kh√¥ng th·ªÉ l·∫•y t√™n hi·ªÉn th·ªã, d√πng t√™n m·∫∑c ƒë·ªãnh.", e);
            }

            const collRef = collection(db, "artifacts", appId, "public", "data", "lessonComments");
            
            try {
                formEl.querySelector('button').disabled = true;
                
                await addDoc(collRef, {
                    lessonId: lessonId,
                    text: text,
                    userId: currentUser.uid,
                    email: currentUser.email || null,
                    displayName: displayName, 
                    timestamp: new Date()
                });
                inputEl.value = '';
                
            } catch (error) {
                console.error("L·ªói khi g·ª≠i b√¨nh lu·∫≠n: ", error);
                let msgEl = formEl.querySelector('.auth-message');
                if (!msgEl) {
                    msgEl = document.createElement('div');
                    msgEl.className = 'auth-message error';
                    formEl.prepend(msgEl);
                }
                msgEl.textContent = 'L·ªói khi g·ª≠i b√¨nh lu·∫≠n. Vui l√≤ng th·ª≠ l·∫°i.';
                msgEl.style.display = 'block';
            } finally {
                formEl.querySelector('button').disabled = false;
            }
        }
        
        // --- 8. T√çNH NƒÇNG AI - T·ª™ V·ª∞NG M·ªñI NG√ÄY ---

        async function fetchWithBackoff(url, options, maxRetries = 5) {
            let delay = 1000;
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (!response.ok) {
                        if (response.status === 429) {
                            throw new Error('Rate limit exceeded');
                        }
                        return response; 
                    }
                    return response;
                } catch (error) {
                    if (i < maxRetries - 1) {
                        await new Promise(resolve => setTimeout(resolve, delay));
                        delay *= 2;
                    } else {
                        throw error;
                    }
                }
            }
        }

        async function fetchWordOfTheDay() {
            if (isFetchingWord) return;
            isFetchingWord = true;
            
            wordLoadingEl.style.display = 'block';
            wordDisplayEl.style.display = 'none';
            wordErrorEl.style.display = 'none';
            newWordBtn.disabled = true;

            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            
            const systemPrompt = "B·∫°n l√† gi√°o vi√™n ti·∫øng Anh cho h·ªçc sinh l·ªõp 5. H√£y cung c·∫•p m·ªôt t·ª´ v·ª±ng ti·∫øng Anh (term), ƒë·ªãnh nghƒ©a ti·∫øng Vi·ªát (definition), v√† m·ªôt c√¢u v√≠ d·ª• ti·∫øng Anh c√≥ k√®m d·ªãch ti·∫øng Vi·ªát (example). Ch·ªâ tr·∫£ l·ªùi d∆∞·ªõi d·∫°ng JSON.";
            const userQuery = "M·ªôt t·ª´ v·ª±ng ti·∫øng Anh ph·ªï bi·∫øn, ph√π h·ª£p cho h·ªçc sinh l·ªõp 5.";

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                },
                generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: {
                        type: "OBJECT",
                        properties: {
                            "term": { "type": "STRING" },
                            "definition": { "type": "STRING" },
                            "example": { "type": "STRING" }
                        },
                        required: ["term", "definition", "example"]
                    }
                }
            };

            try {
                const response = await fetchWithBackoff(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }

                const result = await response.json();
                const candidate = result.candidates?.[0];
                
                if (candidate && candidate.content?.parts?.[0]?.text) {
                    const jsonText = candidate.content.parts[0].text;
                    const data = JSON.parse(jsonText);
                    
                    updateWordUI(data.term, data.definition, data.example);
                    await generateImageForWord(data.term);
                    
                } else {
                    throw new Error("Kh√¥ng nh·∫≠n ƒë∆∞·ª£c n·ªôi dung h·ª£p l·ªá t·ª´ AI.");
                }

            } catch (error) {
                console.error("L·ªói khi l·∫•y t·ª´ v·ª±ng: ", error);
                wordErrorEl.style.display = 'block';
                wordLoadingEl.style.display = 'none';
            } finally {
                isFetchingWord = false;
                newWordBtn.disabled = false;
            }
        }
        
        function updateWordUI(term, definition, example) {
            wordTermEl.textContent = term.charAt(0).toUpperCase() + term.slice(1);
            wordDefinitionEl.textContent = definition;
            wordExampleEl.textContent = example;
            
            wordLoadingEl.style.display = 'none';
            wordDisplayEl.style.display = 'grid';
        }
        
        async function generateImageForWord(term) {
            wordImageEl.src = "";
            wordImageEl.alt = "ƒêang t·∫°o h√¨nh ·∫£nh...";
            wordImageEl.classList.add('opacity-0'); 
            wordImageEl.parentElement.classList.add('animate-pulse'); 

            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-002:predict?key=${apiKey}`;
            const prompt = `M·ªôt h√¨nh ·∫£nh minh h·ªça ƒë∆°n gi·∫£n, th√¢n thi·ªán v·ªõi tr·∫ª em, phong c√°ch ho·∫°t h√¨nh (cartoon style) cho t·ª´ "${term}".`;

            const payload = {
                instances: { prompt: prompt },
                parameters: { "sampleCount": 1 }
            };

            try {
                const response = await fetchWithBackoff(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }

                const result = await response.json();
                if (result.predictions && result.predictions.length > 0 && result.predictions[0].bytesBase64Encoded) {
                    const imageUrl = `data:image/png;base64,${result.predictions[0].bytesBase64Encoded}`;
                    wordImageEl.src = imageUrl;
                    wordImageEl.alt = `H√¨nh ·∫£nh minh h·ªça cho t·ª´ "${term}"`;
                    wordImageEl.onload = () => {
                        wordImageEl.parentElement.classList.remove('animate-pulse');
                        wordImageEl.classList.remove('opacity-0');
                    }
                } else {
                    throw new Error("Kh√¥ng nh·∫≠n ƒë∆∞·ª£c h√¨nh ·∫£nh t·ª´ AI.");
                }
            } catch (error) {
                console.error("L·ªói khi t·∫°o h√¨nh ·∫£nh: ", error);
                wordImageEl.parentElement.classList.remove('animate-pulse');
                wordImageEl.src = `https://placehold.co/300x250/f0f0f0/aaa?text=L·ªói+t·∫°o+·∫£nh`;
                wordImageEl.alt = "L·ªói khi t·∫°o h√¨nh ·∫£nh";
                wordImageEl.classList.remove('opacity-0');
            }
        }


        // --- 9. T√çNH NƒÇNG B·∫¢NG X·∫æP H·∫†NG (Vi·∫øt ƒëi·ªÉm) ---

        async function updateUserScore(scoreToAdd) {
            if (!currentUser || currentUser.isAnonymous) {
                console.log("Kh√¥ng l∆∞u ƒëi·ªÉm (kh√°ch/·∫©n danh).");
                return; 
            }
            
            if (scoreToAdd <= 0) return;

            const docRef = doc(db, "artifacts", appId, "public", "data", "leaderboard", currentUser.uid);

            let currentDisplayName = currentUser.email ? currentUser.email.split('@')[0] : `User-${currentUser.uid.substring(0, 6)}`;
            try {
                const docSnap = await getDoc(docRef);
                if (docSnap.exists() && docSnap.data().displayName) {
                    currentDisplayName = docSnap.data().displayName;
                }
            } catch (e) {
                console.warn("Kh√¥ng th·ªÉ ƒë·ªçc t√™n hi·ªÉn th·ªã hi·ªán t·∫°i, s·∫Ω d√πng t√™n m·∫∑c ƒë·ªãnh.", e);
            }

            try {
                await setDoc(docRef, {
                    totalScore: increment(scoreToAdd),
                    userId: currentUser.uid,
                    displayName: currentDisplayName, 
                    email: currentUser.email || null, 
                    lastUpdated: new Date()
                }, { merge: true }); 

                console.log(`ƒê√£ c·∫≠p nh·∫≠t ${scoreToAdd} ƒëi·ªÉm cho user ${currentUser.uid} (public)`);
                
            } catch (error) {
                console.error("L·ªói khi c·∫≠p nh·∫≠t ƒëi·ªÉm (leaderboard):", error);
            }
        }
        
        // --- 10. T√çNH NƒÇNG B·∫¢NG X·∫æP H·∫†NG (ƒê·ªçc ƒëi·ªÉm) ---

        async function loadLeaderboard() {
            leaderboardContainerEl.innerHTML = '<p id="leaderboard-loading">ƒêang t·∫£i b·∫£ng x·∫øp h·∫°ng...</p>';
            
            const collRef = collection(db, "artifacts", appId, "public", "data", "leaderboard");
            const q = query(collRef); 

            try {
                const querySnapshot = await getDocs(q);
                
                if (querySnapshot.empty) {
                    leaderboardContainerEl.innerHTML = '<p>Ch∆∞a c√≥ ai tr√™n b·∫£ng x·∫øp h·∫°ng. H√£y ch∆°i game ƒë·ªÉ tr·ªü th√†nh ng∆∞·ªùi ƒë·∫ßu ti√™n!</p>';
                    return;
                }
                
                let leaderboardData = [];
                querySnapshot.forEach((doc) => {
                    leaderboardData.push(doc.data());
                });
                
                leaderboardData.sort((a, b) => (b.totalScore || 0) - (a.totalScore || 0));
                
                const top10 = leaderboardData.slice(0, 10);

                let html = `
                    <table class="leaderboard-table">
                        <thead>
                            <tr>
                                <th>H·∫°ng</th>
                                <th>T√™n ng∆∞·ªùi ch∆°i</th>
                                <th>T·ªïng ƒëi·ªÉm</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                top10.forEach((data, index) => {
                    const rank = index + 1;
                    const name = data.displayName 
                               || (data.email ? data.email.split('@')[0] : 
                                  (data.userId ? `User-${data.userId.substring(0, 6)}` : 'Anonymous'));
                    const score = data.totalScore || 0;
                    
                    html += `
                        <tr>
                            <td>${rank}</td>
                            <td>${name}</td>
                            <td>${score}</td>
                        </tr>
                    `;
                });
                
                html += `
                        </tbody>
                    </table>
                `;
                
                leaderboardContainerEl.innerHTML = html;

            } catch (error) {
                console.error("L·ªói khi t·∫£i b·∫£ng x·∫øp h·∫°ng:", error);
                leaderboardContainerEl.innerHTML = '<p style="color: red;">Kh√¥ng th·ªÉ t·∫£i b·∫£ng x·∫øp h·∫°ng. Vui l√≤ng th·ª≠ l·∫°i.</p>';
            }
        }


        // --- 11. KH·ªûI T·∫†O APP KHI DOM ƒê√É T·∫¢I ---
        
        document.addEventListener('DOMContentLoaded', async () => {
            
            try {
                app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);
                setLogLevel('Debug');
                console.log("Firebase ƒë√£ kh·ªüi t·∫°o th√†nh c√¥ng.");

                onAuthStateChanged(auth, (user) => {
                    if (user && !user.isAnonymous) {
                        currentUser = user;
                        loginLink.style.display = 'none';
                        registerLink.style.display = 'none';
                        profileLink.style.display = 'block';
                        logoutLink.style.display = 'block';
                    } else {
                        currentUser = user;
                        loginLink.style.display = 'block';
                        registerLink.style.display = 'block';
                        profileLink.style.display = 'none';
                        logoutLink.style.display = 'none';
                    }
                    
                    window.showPage(currentPage);
                });

                if (token) {
                    await signInWithCustomToken(auth, token);
                    console.log("ƒêƒÉng nh·∫≠p b·∫±ng Custom Token th√†nh c√¥ng.");
                } else {
                    await signInAnonymously(auth);
                    console.log("ƒêƒÉng nh·∫≠p ·∫©n danh th√†nh c√¥ng.");
                }

            } catch (error) {
                console.error("L·ªói kh·ªüi t·∫°o Firebase: ", error);
            }

            // G√°n c√°c Element cho bi·∫øn
            videoModal = document.getElementById('video-modal');
            modalVideoTitle = document.getElementById('modal-video-title');
            modalVideoIframe = document.getElementById('modal-video-iframe');
            modalAlertContent = document.getElementById('modal-alert-content');
            modalAlertText = document.getElementById('modal-alert-text');


            // G√°n element cho Auth & Profile
            loginLink = document.getElementById('login-link');
            registerLink = document.getElementById('register-link');
            profileLink = document.getElementById('profile-link');
            logoutLink = document.getElementById('logout-link');
            profileEmailEl = document.getElementById('profile-email');
            profileUserIdEl = document.getElementById('profile-userid');
            profileLogoutBtn = document.getElementById('profile-logout-btn');
            profileQuizResultsEl = document.getElementById('profile-quiz-results');
            profileLessonProgressEl = document.getElementById('profile-lesson-progress');
            
            profileUpdateForm = document.getElementById('profile-update-form');
            profileDisplayNameInput = document.getElementById('profile-display-name');
            profileMessageEl = document.getElementById('profile-message');

            // G√°n element cho Quiz
            quizTitleEl = document.getElementById('quiz-title');
            quizQuestionEl = document.getElementById('quiz-question');
            quizOptionsEl = document.getElementById('quiz-options');
            quizNextBtn = document.getElementById('quiz-next-btn');
            quizContentEl = document.getElementById('quiz-content');
            quizResultEl = document.getElementById('quiz-result');
            quizScoreEl = document.getElementById('quiz-score');
            
            // G√°n element cho Game
            flashcardGrid = document.getElementById('flashcard-grid');
            flipsEl = document.getElementById('flashcard-flips');
            
            wcGridEl = document.getElementById('wc-grid');
            wcFoundWordsEl = document.getElementById('wc-found-words');
            wcFoundListEl = document.getElementById('wc-found-list');
            wcCurrentWordEl = document.getElementById('wc-current-word');
            wcShuffleBtn = document.getElementById('wc-shuffle-btn');
            wcNextLevelBtn = document.getElementById('wc-next-level-btn');
            wcLevelInfoEl = document.getElementById('wc-level-info');

            fbSentenceStartEl = document.getElementById('fb-sentence-start');
            fbSentenceEndEl = document.getElementById('fb-sentence-end');
            fbInputEl = document.getElementById('fb-input');
            fbCheckBtn = document.getElementById('fb-check-btn');
            fbFeedbackEl = document.getElementById('fb-feedback');
            fbProgressEl = document.getElementById('fb-progress');
            fbGameAreaEl = document.getElementById('fb-game-area');
            fbResultsEl = document.getElementById('fb-results');
            fbResultsScoreEl = document.getElementById('fb-results-score');
            fbRestartBtn = document.getElementById('fb-restart-btn');

            // G√°n element cho t√≠nh nƒÉng AI
            wordLoadingEl = document.getElementById('word-loading');
            wordDisplayEl = document.getElementById('word-display');
            wordImageEl = document.getElementById('word-image');
            wordTermEl = document.getElementById('word-term');
            wordDefinitionEl = document.getElementById('word-definition');
            wordExampleEl = document.getElementById('word-example');
            wordErrorEl = document.getElementById('word-error');
            newWordBtn = document.getElementById('new-word-btn');
            
            // G√°n element cho B·∫£ng x·∫øp h·∫°ng
            leaderboardContainerEl = document.getElementById('leaderboard-table-container');
            leaderboardLoadingEl = document.getElementById('leaderboard-loading');

            // Th√™m tr√¨nh x·ª≠ l√Ω s·ª± ki·ªán
            document.getElementById('login-form').addEventListener('submit', handleLogin);
            document.getElementById('register-form').addEventListener('submit', handleRegister);
            
            profileUpdateForm.addEventListener('submit', handleUpdateProfile);
            
            wcGridEl.addEventListener('mousedown', handleWCGridMouseStart);
            document.addEventListener('mousemove', handleWCGridMouseMove);
            document.addEventListener('mouseup', handleWCGridMouseEnd);
            wcGridEl.addEventListener('touchstart', handleWCGridMouseStart, { passive: false });
            document.addEventListener('touchmove', handleWCGridMouseMove, { passive: false });
            document.addEventListener('touchend', handleWCGridMouseEnd);
            
            wcShuffleBtn.addEventListener('click', shuffleWCGrid);
            wcNextLevelBtn.addEventListener('click', () => initWordConnectGame(wcCurrentLevel + 1));
            
            fbCheckBtn.addEventListener('click', checkFillBlankAnswer);
            fbRestartBtn.addEventListener('click', initFillBlankGame);

            newWordBtn.addEventListener('click', fetchWordOfTheDay);

            // Hi·ªÉn th·ªã trang ch·ªß ban ƒë·∫ßu
            window.showPage('home');
            
            // T·∫£i t·ª´ v·ª±ng l·∫ßn ƒë·∫ßu khi v√†o trang
            fetchWordOfTheDay();
        });

    </script>

</body>
</html>
